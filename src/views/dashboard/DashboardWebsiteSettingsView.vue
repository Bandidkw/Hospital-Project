<template>
  <div class="p-6 bg-white rounded-xl shadow-2xl transition duration-500">
    <h2 class="text-3xl font-extrabold text-gray-800 mb-2 flex items-center">
      <i class="fas fa-globe mr-4 text-cyan-600"></i> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå
    </h2>
    <p class="text-gray-600 mb-6 border-b pb-4">
      ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå ‡πÄ‡∏ä‡πà‡∏ô ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•, ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà, ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå,
      ‡πÅ‡∏•‡∏∞‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå.
    </p>

    <div v-if="loading" class="text-center py-12">
      <i class="fas fa-spinner fa-spin text-6xl text-blue-500"></i>
      <p class="mt-4 text-lg text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤...</p>
    </div>

    <form v-else @submit.prevent="saveWebsiteSettings" class="space-y-8">
      <div class="card bg-gray-200 p-6 rounded-xl shadow-lg border-t-4 border-blue-500">
        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
          <i class="fas fa-info-circle mr-2 text-blue-500"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label for="hospitalNameTh" class="block text-sm font-semibold text-gray-700"
              >‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• (‡πÄ‡∏ï‡πá‡∏°):</label
            >
            <input
              type="text"
              id="hospitalNameTh"
              v-model="websiteSettings.hospitalNameTh"
              required
              class="mt-1 block w-full border-gray-300 rounded-lg shadow-sm p-3 placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500"
              placeholder="‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÅ‡∏°‡πà‡πÅ‡∏ï‡∏á"
            />
          </div>
          <div>
            <label for="hospitalNameEn" class="block text-sm font-semibold text-gray-700"
              >‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• (English/‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡πà‡∏≠):</label
            >
            <input
              type="text"
              id="hospitalNameEn"
              v-model="websiteSettings.hospitalNameEn"
              class="mt-1 block w-full border-gray-300 rounded-lg shadow-sm p-3 placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500"
              placeholder="Maetaeng Hospital"
            />
          </div>

          <div class="col-span-full">
            <label for="address" class="block text-sm font-semibold text-gray-700"
              >‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•:</label
            >
            <textarea
              id="address"
              v-model="websiteSettings.address"
              rows="3"
              class="mt-1 block w-full border-gray-300 rounded-lg shadow-sm p-3 placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500"
            ></textarea>
          </div>

          <div>
            <label for="zipCode" class="block text-sm font-semibold text-gray-700"
              >‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå:</label
            >
            <input
              type="text"
              id="zipCode"
              v-model="websiteSettings.zipCode"
              class="mt-1 block w-full border-gray-300 rounded-lg shadow-sm p-3 placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500"
            />
          </div>
          <div>
            <label for="province" class="block text-sm font-semibold text-gray-700">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î:</label>
            <input
              type="text"
              id="province"
              v-model="websiteSettings.province"
              class="mt-1 block w-full border-gray-300 rounded-lg shadow-sm p-3 placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500"
            />
          </div>
        </div>
      </div>

      <div class="card bg-gray-200 p-6 rounded-xl shadow-lg border-t-4 border-green-500">
        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
          <i class="fas fa-phone-alt mr-2 text-green-600"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label for="telMain" class="block text-sm font-semibold text-gray-700"
              >‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏´‡∏•‡∏±‡∏Å:</label
            >
            <input
              type="tel"
              id="telMain"
              v-model="websiteSettings.telMain"
              class="mt-1 block w-full border-gray-300 rounded-lg shadow-sm p-3 placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500"
              placeholder="053-XXX-XXXX"
            />
          </div>
          <div>
            <label for="fax" class="block text-sm font-semibold text-gray-700"
              >‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏™‡∏≤‡∏£ (FAX):</label
            >
            <input
              type="tel"
              id="fax"
              v-model="websiteSettings.fax"
              class="mt-1 block w-full border-gray-300 rounded-lg shadow-sm p-3 placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500"
              placeholder="053-YYY-YYYY"
            />
          </div>

          <div class="col-span-full">
            <label for="emailMain" class="block text-sm font-semibold text-gray-700"
              >‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏•‡∏±‡∏Å:</label
            >
            <input
              type="email"
              id="emailMain"
              v-model="websiteSettings.emailMain"
              class="mt-1 block w-full border-gray-300 rounded-lg shadow-sm p-3 placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500"
              placeholder="info@yourhospital.com"
            />
          </div>
        </div>
      </div>

      <div class="card bg-gray-200 p-6 rounded-xl shadow-lg border-t-4 border-cyan-500">
        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
          <i class="fas fa-share-alt mr-2 text-cyan-600"></i> Social Media / ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label for="facebookUrl" class="block text-sm font-semibold text-gray-700"
              >Facebook URL:</label
            >
            <input
              type="url"
              id="facebookUrl"
              v-model="websiteSettings.facebookUrl"
              class="mt-1 block w-full border-gray-300 rounded-lg shadow-sm p-3 placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500"
              placeholder="https://www.facebook.com/..."
            />
          </div>
          <div>
            <label for="lineId" class="block text-sm font-semibold text-gray-700"
              >LINE ID/URL:</label
            >
            <input
              type="text"
              id="lineId"
              v-model="websiteSettings.lineId"
              class="mt-1 block w-full border-gray-300 rounded-lg shadow-sm p-3 placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500"
              placeholder="@yourlineid"
            />
          </div>

          <div>
            <label for="youtubeUrl" class="block text-sm font-semibold text-gray-700"
              >Youtube URL:</label
            >
            <input
              type="url"
              id="youtubeUrl"
              v-model="websiteSettings.youtubeUrl"
              class="mt-1 block w-full border-gray-300 rounded-lg shadow-sm p-3 placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500"
              placeholder="https://www.youtube.com/..."
            />
          </div>
          <div>
            <label for="twitterUrl" class="block text-sm font-semibold text-gray-700"
              >Twitter (X) URL:</label
            >
            <input
              type="url"
              id="twitterUrl"
              v-model="websiteSettings.twitterUrl"
              class="mt-1 block w-full border-gray-300 rounded-lg shadow-sm p-3 placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500"
              placeholder="https://twitter.com/..."
            />
          </div>

          <div class="col-span-full">
            <label for="googleMapIframe" class="block text-sm font-semibold text-gray-700"
              >Google Maps Embed Code (iFrame):</label
            >
            <textarea
              id="googleMapIframe"
              v-model="websiteSettings.googleMapIframe"
              rows="4"
              class="mt-1 block w-full border-gray-300 rounded-lg shadow-sm p-3 font-mono text-xs placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500"
              placeholder="‡∏ß‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î iframe ‡∏ó‡∏µ‡πà‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏°‡∏≤‡∏à‡∏≤‡∏Å Google Maps"
            ></textarea>
            <p class="text-xs text-gray-500 mt-1">
              ‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î HTML iFrame ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£ "‡∏ù‡∏±‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà" ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
            </p>
          </div>
        </div>
      </div>

      <div class="card bg-gray-50 p-6 rounded-xl shadow-lg border-t-4 border-yellow-500">
        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
          <i class="fas fa-search mr-2 text-yellow-600"></i> SEO (‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤)
        </h3>
        <div class="space-y-4">
          <div>
            <label for="metaDescription" class="block text-sm font-semibold text-gray-700"
              >Meta Description (160 ‡∏≠‡∏±‡∏Å‡∏Ç‡∏£‡∏∞):</label
            >
            <textarea
              id="metaDescription"
              v-model="websiteSettings.metaDescription"
              rows="3"
              maxlength="160"
              class="mt-1 block w-full border-gray-300 rounded-lg shadow-sm p-3 placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500"
            ></textarea>
            <p class="text-xs text-gray-500 mt-1">
              {{ websiteSettings.metaDescription?.length || 0 }} / 160 ‡∏≠‡∏±‡∏Å‡∏Ç‡∏£‡∏∞
            </p>
          </div>

          <div>
            <label for="keywords" class="block text-sm font-semibold text-gray-700"
              >Keywords (‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≠‡∏°‡∏°‡πà‡∏≤):</label
            >
            <input
              type="text"
              id="keywords"
              v-model="websiteSettings.keywords"
              class="mt-1 block w-full border-gray-300 rounded-lg shadow-sm p-3 placeholder-gray-400 focus:ring-blue-500 focus:border-blue-500"
              placeholder="‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•, ‡πÅ‡∏°‡πà‡πÅ‡∏ï‡∏á, ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û, ‡πÅ‡∏û‡∏ó‡∏¢‡πå"
            />
          </div>
        </div>
      </div>

      <div class="pt-4 flex justify-end">
        <button
          type="submit"
          :disabled="isSaving"
          class="flex items-center bg-blue-600 text-white px-8 py-3 rounded-xl hover:bg-blue-700 transition duration-300 text-lg shadow-lg disabled:bg-gray-400 disabled:cursor-not-allowed"
        >
          <i class="fas fa-spinner fa-spin mr-2" v-if="isSaving"></i>
          <i class="fas fa-save mr-2" v-else></i>
          {{ isSaving ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...' : '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤' }}
        </button>
      </div>
    </form>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue'
import { useToast } from 'vue-toastification'
// üí° ‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ Service ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ API ‡∏à‡∏£‡∏¥‡∏á‡πÅ‡∏•‡πâ‡∏ß
import { fetchSettings, updateSettings } from '@/services/settingsService'
import type { SettingsData } from '@/types/settings'

const toast = useToast()

// ------------------------------------------------------------------
// 1. STATE MANAGEMENT
// ------------------------------------------------------------------

// üü¢ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á State ‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÅ‡∏•‡∏∞‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö SettingsData
const websiteSettings = ref<SettingsData>({
  id: 'global-settings-1',
  hospitalNameTh: '',
  hospitalNameEn: '',
  address: '',
  zipCode: '',
  province: '',
  telMain: '',
  fax: '',
  emailMain: '',
  facebookUrl: '',
  lineId: '',
  youtubeUrl: '', // üü¢ ‡πÄ‡∏û‡∏¥‡πà‡∏° field ‡∏ó‡∏µ‡πà‡∏´‡∏≤‡∏¢‡πÑ‡∏õ
  twitterUrl: '', // üü¢ ‡πÄ‡∏û‡∏¥‡πà‡∏° field ‡∏ó‡∏µ‡πà‡∏´‡∏≤‡∏¢‡πÑ‡∏õ
  googleMapIframe: '',
  metaDescription: '',
  keywords: '',
})

const loading = ref(true)
const isSaving = ref(false)

// ------------------------------------------------------------------
// 2. LIFECYCLE & DATA FETCHING
// ------------------------------------------------------------------

const fetchWebsiteSettings = async () => {
  // 1. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏•‡∏î (loading.value ‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô true ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤ try/catch)
  loading.value = true
  try {
    const data = await fetchSettings()
    websiteSettings.value = data
  } catch (e) {
    toast.error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÑ‡∏î‡πâ')
    console.error('Fetch settings failed:', e)
  } finally {
    // üü¢ 2. ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á loading.value = false ‡πÄ‡∏™‡∏°‡∏≠ ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏´‡∏£‡∏∑‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß
    loading.value = false
  }
}

// ------------------------------------------------------------------
// 3. SAVE LOGIC
// ------------------------------------------------------------------

const saveWebsiteSettings = async () => {
  isSaving.value = true
  try {
    // üí° ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô updateSettings ‡∏à‡∏∞‡πÉ‡∏ä‡πâ PATCH /settings/1 ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏ô Service
    await updateSettings(websiteSettings.value)
    toast.success('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!')
  } catch (e: unknown) {
    console.error('Error saving website settings:', e)
    toast.error('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß')
  } finally {
    isSaving.value = false
  }
}

onMounted(fetchWebsiteSettings)
</script>
