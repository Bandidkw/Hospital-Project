<template>
  <div class="container mx-auto p-8 bg-white my-8 rounded-xl shadow-lg">
    <h1 class="text-4xl font-extrabold text-blue-800 mb-2">‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</h1>
    <p class="text-gray-700 leading-relaxed mb-8 border-b pb-4">
      ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÅ‡∏°‡πà‡πÅ‡∏ï‡∏á‡∏†‡∏≤‡∏Ñ‡∏†‡∏π‡∏°‡∏¥‡πÉ‡∏à‡πÉ‡∏ô‡∏ó‡∏µ‡∏°‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç
      ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏Å‡πà‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô...
    </p>

    <div v-if="loading" class="text-center py-10 text-gray-500">
      <i class="fas fa-spinner fa-spin text-4xl"></i>
      <p class="mt-4 text-lg">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£...</p>
    </div>

    <div v-else-if="errorMsg" class="text-center py-10 text-red-600">
      <i class="fas fa-exclamation-triangle text-4xl"></i>
      <p class="mt-4 text-lg">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: {{ errorMsg }}</p>
    </div>

    <div v-else-if="personnelList.length > 0">
      <h2 class="text-2xl font-bold text-gray-800 border-b-2 border-blue-100 pb-2 mb-6">
        ‡∏Ñ‡∏ì‡∏∞‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÅ‡∏°‡πà‡πÅ‡∏ï‡∏á
      </h2>

      <div
        v-if="directorList.length > 0"
        class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 mb-12 justify-items-center"
      >
        <PersonnelCard v-for="p in directorList" :key="p.id" :personnel="p" :is-director="true" />
      </div>
      <div v-else class="text-center py-5 text-gray-500 mb-8">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ì‡∏∞‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£</div>

      <h2 class="text-2xl font-bold text-gray-800 border-b-2 border-blue-100 pb-2 mb-6">‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</h2>

      <div
        v-if="staffList.length > 0"
        class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6"
      >
        <PersonnelCard v-for="p in staffList" :key="p.id" :personnel="p" />
      </div>
      <div v-else class="text-center py-5 text-gray-500 mb-8">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</div>
    </div>

    <div v-else class="text-center py-10 text-gray-500">
      <p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted, computed } from 'vue'
import { getPublicPersonnelList } from '@/services/personnelService'
import type { PersonnelItem } from '@/types/personnel'
import PersonnelCard from '@/components/PersonnelCard.vue'

const personnelList = ref<PersonnelItem[]>([])
const loading = ref(true)
const errorMsg = ref<string | null>(null)

// ------------------------------------------------------------------
// üü¢ Computed Properties ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡πà‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á
// ------------------------------------------------------------------

const directorList = computed(() => {
  return personnelList.value
    .filter((p) => p.isDirector) // ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà isDirector ‡πÄ‡∏õ‡πá‡∏ô true
    .sort((a, b) => {
      // Logic ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á: ‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô "‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£" ‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡πà‡∏≠‡∏ô "‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£" ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏≠‡∏∑‡πà‡∏ô‡πÜ
      const posA = a.position.toLowerCase()
      const posB = b.position.toLowerCase()

      // ‡πÉ‡∏´‡πâ '‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£' ‡∏´‡∏£‡∏∑‡∏≠ 'director' ‡∏°‡∏µ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤
      const isDirectorA = posA.includes('‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£') || posA.includes('director')
      const isDirectorB = posB.includes('‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£') || posB.includes('director')

      if (isDirectorA && !isDirectorB) return -1
      if (!isDirectorA && isDirectorB) return 1

      // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô ‡πÉ‡∏´‡πâ‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£ 1, 2, ...)
      return posA.localeCompare(posB)
    })
})

const staffList = computed(() => {
  // ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà isDirector ‡πÄ‡∏õ‡πá‡∏ô false
  return (
    personnelList.value
      .filter((p) => !p.isDirector)
      // (‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å) ‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏ï‡∏≤‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠
      .sort((a, b) => a.position.localeCompare(b.position))
  )
})

// ------------------------------------------------------------------
// Fetch Data
// ------------------------------------------------------------------

const fetchPersonnel = async () => {
  try {
    const data = await getPublicPersonnelList()
    personnelList.value = data
  } catch (e) {
    // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Error (‡∏≠‡∏≤‡∏à‡πÉ‡∏ä‡πâ isAxiosError ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏ô‡∏µ‡πâ)
    errorMsg.value = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡πÑ‡∏î‡πâ'
    console.error('Fetch personnel failed:', e)
  } finally {
    loading.value = false
  }
}

onMounted(fetchPersonnel)
</script>

<style scoped>
/* ‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏≤‡∏à‡πÄ‡∏û‡∏¥‡πà‡∏° styles ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ Tailwind CSS Classes */
</style>
