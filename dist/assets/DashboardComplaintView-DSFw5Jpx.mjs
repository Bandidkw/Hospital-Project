import{d as T,r as u,l as A,s as O,p as V,a as d,a0 as Q,c,k as h,b as t,e as i,t as n,f as C,g as M,v as N,u as G,o as J,j as K,F as P,h as R,n as W,i as j}from"./index-C1nZs7mf.mjs";import{g as X,d as Y,u as Z}from"./complaintService-BxRLt6Wd.mjs";const tt={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 transition-opacity duration-300"},et={class:"bg-white p-8 rounded-lg shadow-2xl max-w-xl w-full transform transition-all duration-300"},st={class:"text-2xl font-bold text-red-700 mb-4 flex items-center"},ot={class:"border p-4 rounded-md bg-gray-50 mb-6"},lt={class:"mb-2"},at={class:"mb-2 text-sm text-gray-500"},nt={class:"mb-4 text-xs text-gray-500"},rt={class:"p-3 border rounded-md bg-white"},it={class:"whitespace-pre-wrap text-gray-800"},dt={key:0,class:"mb-6"},ut={class:"p-3 border border-gray-300 rounded-md bg-gray-100"},ct={class:"whitespace-pre-wrap text-gray-800"},pt={class:"space-y-4 mb-8"},mt={class:"flex justify-end space-x-3"},ft=["disabled"],xt=T({__name:"ComplaintModal",props:{show:{type:Boolean},complaint:{}},emits:["update-status","close"],setup($,{emit:g}){const r=$,f=g,p=u(r.complaint.status),m=u(r.complaint.resolutionDetail||""),x=A(()=>p.value!==r.complaint.status||m.value!==(r.complaint.resolutionDetail||""));O(()=>r.complaint,a=>{p.value=a.status,m.value=a.resolutionDetail||""},{immediate:!0});const v=a=>new Date(a).toLocaleDateString("th-TH",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),y=()=>{x.value&&f("update-status",{status:p.value,resolutionDetail:m.value})};return(a,s)=>(d(),V(Q,{to:"body"},[a.show?(d(),c("div",tt,[t("div",et,[t("h3",st,[s[3]||(s[3]=t("i",{class:"fas fa-comment-dots mr-3"},null,-1)),i(" รายละเอียดข้อร้องเรียน (ID: "+n(a.complaint.code)+") ",1)]),t("div",ot,[t("p",lt,[s[4]||(s[4]=t("span",{class:"font-semibold"},"หัวข้อ:",-1)),i(" "+n(a.complaint.subject),1)]),t("p",at,[s[5]||(s[5]=t("span",{class:"font-semibold"},"ผู้แจ้ง:",-1)),i(" "+n(a.complaint.complainantName||"ไม่ระบุ")+" (ติดต่อ: "+n(a.complaint.contactInfo||"-")+") ",1)]),t("p",nt,[s[6]||(s[6]=t("span",{class:"font-semibold"},"วันที่แจ้ง:",-1)),i(" "+n(v(a.complaint.createdAt)),1)]),t("div",rt,[s[7]||(s[7]=t("p",{class:"font-semibold text-gray-700 mb-1"},"รายละเอียด:",-1)),t("p",it,n(a.complaint.description),1)])]),a.complaint.resolutionDetail?(d(),c("div",dt,[s[8]||(s[8]=t("p",{class:"font-semibold text-gray-700 mb-2"},"รายละเอียดการแก้ไข (เดิม):",-1)),t("div",ut,[t("p",ct,n(a.complaint.resolutionDetail),1)])])):h("",!0),t("div",pt,[t("div",null,[s[10]||(s[10]=t("label",{for:"status",class:"font-semibold text-gray-700 block mb-1"},"อัปเดตสถานะ:",-1)),C(t("select",{id:"status","onUpdate:modelValue":s[0]||(s[0]=w=>p.value=w),class:"block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-red-500 focus:border-red-500"},s[9]||(s[9]=[t("option",{value:"pending"},"รอดำเนินการ",-1),t("option",{value:"in_progress"},"อยู่ระหว่างตรวจสอบ",-1),t("option",{value:"resolved"},"แก้ไขแล้ว",-1),t("option",{value:"rejected"},"ปิดเคสแล้ว",-1)]),512),[[M,p.value]])]),t("div",null,[s[11]||(s[11]=t("label",{for:"resolution-notes",class:"font-semibold text-gray-700 block mb-1"},"รายละเอียดการแก้ไข:",-1)),C(t("textarea",{id:"resolution-notes","onUpdate:modelValue":s[1]||(s[1]=w=>m.value=w),rows:"4",placeholder:"ระบุเหตุผล/มาตรการที่ใช้ในการจัดการข้อร้องเรียนนี้",class:"block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-red-500 focus:border-red-500"},null,512),[[N,m.value]])])]),t("div",mt,[t("button",{onClick:y,disabled:!x.value,class:"bg-red-600 text-white px-6 py-2 rounded-md hover:bg-red-700 transition duration-300 disabled:opacity-50"},s[12]||(s[12]=[t("i",{class:"fas fa-check mr-2"},null,-1),i(" บันทึกและอัปเดต ")]),8,ft),t("button",{onClick:s[2]||(s[2]=w=>a.$emit("close")),class:"bg-gray-400 text-white px-6 py-2 rounded-md hover:bg-gray-500 transition duration-300"},s[13]||(s[13]=[t("i",{class:"fas fa-times mr-2"},null,-1),i(" ปิด ")]))])])])):h("",!0)]))}}),bt={class:"p-8 bg-gray-100 min-h-screen"},gt={class:"text-gray-600 mb-6 pb-4 border-b"},yt={class:"mb-6 flex space-x-4 p-4 bg-white rounded-xl shadow-md border border-gray-200"},vt={class:"relative flex-grow"},wt={class:"bg-white p-6 rounded-xl shadow-2xl"},ht={key:0,class:"text-center py-10"},Ct={key:1,class:"text-center py-10 text-red-600 border border-red-300 bg-red-50 rounded-lg"},kt={class:"mt-2 text-xl font-medium"},Dt={key:2,class:"overflow-x-auto relative"},$t={class:"min-w-full bg-white rounded-lg border-collapse"},Lt={class:"text-gray-700 text-sm font-light"},_t={class:"py-3 px-4 text-left font-semibold"},St={class:"py-3 px-4 text-left text-xs"},jt={class:"py-3 px-4 text-left font-medium max-w-xs truncate"},Tt={class:"py-3 px-4 text-left"},At={class:"py-3 px-4 text-center"},Vt={class:"py-3 px-4 text-center whitespace-nowrap"},Mt=["onClick"],Nt=["onClick"],It={key:0},Ut={key:1,class:"fixed inset-0 bg-gray-900 bg-opacity-70 flex items-center justify-center z-50 transition-opacity duration-300"},Ft=T({__name:"DashboardComplaintView",setup($){const g=G(),r=u([]),f=u(null),p=u(!1),m=u(!1),x=u(null),v=u(!0),y=u(null),a=u("ALL"),s=u("");J(async()=>{v.value=!0,y.value=null;try{const o=await X();r.value=o}catch(o){y.value="ไม่สามารถโหลดรายการข้อร้องเรียนได้ (ลองตรวจสอบ Service Log)",console.error("Fetch complaints failed:",o)}finally{v.value=!1}});const k=A(()=>{let o=r.value;if(a.value!=="ALL"&&(o=o.filter(e=>e.status===a.value)),s.value){const e=s.value.toLowerCase();o=o.filter(l=>l.subject.toLowerCase().includes(e)||l.description.toLowerCase().includes(e)||l.complainantName?.toLowerCase().includes(e)||l.contactInfo.toLowerCase().includes(e))}return o.sort((e,l)=>new Date(l.createdAt).getTime()-new Date(e.createdAt).getTime()),o}),I=o=>o?new Date(o).toLocaleDateString("th-TH",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-",U=o=>{switch(o){case"pending":return"inline-block px-3 py-1 text-xs font-semibold leading-none rounded-full text-yellow-800 bg-yellow-200";case"in_progress":return"inline-block px-3 py-1 text-xs font-semibold leading-none rounded-full text-red-800 bg-red-200";case"resolved":return"inline-block px-3 py-1 text-xs font-semibold leading-none rounded-full text-green-800 bg-green-200";case"rejected":return"inline-block px-3 py-1 text-xs font-semibold leading-none rounded-full text-gray-800 bg-gray-300";default:return""}},L=o=>{switch(o){case"pending":return"รอดำเนินการ";case"in_progress":return"อยู่ระหว่างตรวจสอบ";case"resolved":return"แก้ไขแล้ว";case"rejected":return"ปิดเคสแล้ว";default:return"ไม่ระบุสถานะ"}},B=o=>{f.value={...o},p.value=!0},_=()=>{p.value=!1,f.value=null},z=async o=>{if(!f.value)return;const e=f.value.id;try{const l={status:o.status,resolutionDetail:o.resolutionDetail},b=await Z(e,l);g.success(`อัปเดตสถานะเป็น "${L(b.status)}" สำเร็จ`);const D=r.value.findIndex(q=>q.id===e);D!==-1&&(r.value[D].status=b.status,r.value[D].resolutionDetail=b.resolutionDetail),_()}catch(l){const b=j(l)?l.response?.data?.message||"การอัปเดตสถานะล้มเหลว":"เกิดข้อผิดพลาดในการเชื่อมต่อ";g.error(b),console.error("Update status failed:",l)}},F=o=>{x.value=o,m.value=!0},H=async()=>{if(x.value)try{await Y(x.value),g.success("ลบข้อร้องเรียนสำเร็จ!"),r.value=r.value.filter(o=>o.id!==x.value)}catch(o){const e=j(o)?o.response?.data?.message||"การลบข้อมูลล้มเหลว":"เกิดข้อผิดพลาดในการลบข้อมูล";g.error(e),console.error("Delete failed:",o)}finally{S()}},E=()=>{S()},S=()=>{x.value=null,m.value=!1};return(o,e)=>(d(),c("div",bt,[e[17]||(e[17]=t("h2",{class:"text-4xl font-extrabold text-gray-900 mb-2 flex items-center"},[t("i",{class:"fas fa-inbox mr-4 text-red-600"}),i(" ศูนย์จัดการข้อร้องเรียน ")],-1)),t("p",gt," รายการข้อร้องเรียนทั้งหมดจากผู้ใช้ (รวม "+n(k.value.length)+" รายการ) ",1),t("div",yt,[e[4]||(e[4]=t("label",{for:"status-filter",class:"flex items-center text-gray-700 font-medium whitespace-nowrap"},[t("i",{class:"fas fa-filter mr-2 text-red-500"}),i(" กรองสถานะ: ")],-1)),C(t("select",{id:"status-filter","onUpdate:modelValue":e[0]||(e[0]=l=>a.value=l),class:"p-2 border border-gray-300 rounded-lg shadow-sm focus:ring-red-500 focus:border-red-500 transition duration-150"},e[2]||(e[2]=[K('<option value="ALL">— ทั้งหมด —</option><option value="pending">รอดำเนินการ</option><option value="in_progress">กำลังดำเนินการ</option><option value="resolved">แก้ไขแล้ว</option><option value="rejected">ปิดเคสแล้ว</option>',5)]),512),[[M,a.value]]),t("div",vt,[e[3]||(e[3]=t("i",{class:"fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"},null,-1)),C(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=l=>s.value=l),placeholder:"ค้นหาจากหัวข้อ/รายละเอียด/ผู้แจ้ง...",class:"w-full pl-10 pr-4 p-2 border border-gray-300 rounded-lg shadow-sm focus:ring-red-500 focus:border-red-500 transition duration-150"},null,512),[[N,s.value]])])]),t("div",wt,[e[11]||(e[11]=t("h3",{class:"text-2xl font-semibold text-gray-800 mb-6 border-b pb-3"}," รายการข้อร้องเรียนล่าสุด ",-1)),v.value?(d(),c("div",ht,e[5]||(e[5]=[t("i",{class:"fas fa-spinner fa-spin text-5xl text-red-500"},null,-1),t("p",{class:"mt-4 text-lg text-gray-600"},"กำลังโหลดข้อมูล...",-1)]))):y.value?(d(),c("div",Ct,[e[6]||(e[6]=t("i",{class:"fas fa-exclamation-triangle text-4xl"},null,-1)),t("p",kt,n(y.value),1)])):(d(),c("div",Dt,[t("table",$t,[e[10]||(e[10]=t("thead",null,[t("tr",{class:"bg-red-600 text-white text-left uppercase text-sm leading-normal shadow-md"},[t("th",{class:"py-3 px-4 text-left rounded-tl-lg"},"#ID"),t("th",{class:"py-3 px-4 text-left"},"วันที่/เวลา"),t("th",{class:"py-3 px-4 text-left"},"หัวข้อ"),t("th",{class:"py-3 px-4 text-left"},"ผู้แจ้ง"),t("th",{class:"py-3 px-4 text-center"},"สถานะ"),t("th",{class:"py-3 px-4 text-center rounded-tr-lg"},"การจัดการ")])],-1)),t("tbody",Lt,[(d(!0),c(P,null,R(k.value,l=>(d(),c("tr",{key:l.id,class:"border-b border-gray-200 hover:bg-red-50 transition duration-150"},[t("td",_t,n(l.code),1),t("td",St,n(I(l.createdAt)),1),t("td",jt,n(l.subject),1),t("td",Tt,n(l.complainantName||"ไม่ระบุ"),1),t("td",At,[t("span",{class:W(U(l.status))},n(L(l.status)),3)]),t("td",Vt,[t("button",{onClick:b=>B(l),class:"bg-red-500 text-white px-3 py-1 rounded-full text-xs hover:bg-red-600 transition duration-300 mr-2 shadow-sm"},e[7]||(e[7]=[t("i",{class:"fas fa-search mr-1"},null,-1),i(" ดู/จัดการ ")]),8,Mt),t("button",{onClick:b=>F(l.id),class:"bg-gray-400 text-white px-3 py-1 rounded-full text-xs hover:bg-gray-500 transition duration-300 shadow-sm"},e[8]||(e[8]=[t("i",{class:"fas fa-trash-alt mr-1"},null,-1),i(" ลบ ")]),8,Nt)])]))),128)),k.value.length===0?(d(),c("tr",It,e[9]||(e[9]=[t("td",{colspan:"6",class:"py-8 text-center text-gray-500 bg-gray-50"},[t("i",{class:"fas fa-info-circle mr-2"}),i(" ไม่พบรายการข้อร้องเรียนที่ตรงกับเงื่อนไขการค้นหา ")],-1)]))):h("",!0)])])]))]),f.value?(d(),V(xt,{key:0,show:p.value,complaint:f.value,onClose:_,onUpdateStatus:z},null,8,["show","complaint"])):h("",!0),m.value?(d(),c("div",Ut,[t("div",{class:"bg-white p-8 rounded-xl shadow-2xl max-w-sm w-full text-center transform transition-all duration-300 scale-100"},[e[14]||(e[14]=t("i",{class:"fas fa-exclamation-circle text-red-500 text-4xl mb-4"},null,-1)),e[15]||(e[15]=t("h3",{class:"text-xl font-bold text-gray-800 mb-2"},"ยืนยันการลบข้อร้องเรียน",-1)),e[16]||(e[16]=t("p",{class:"text-gray-600 mb-6"}," คุณแน่ใจหรือไม่ว่าต้องการลบข้อร้องเรียนนี้? การดำเนินการนี้ไม่สามารถย้อนกลับได้ ",-1)),t("div",{class:"flex justify-center space-x-4"},[t("button",{onClick:H,class:"bg-red-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-red-700 transition duration-300"},e[12]||(e[12]=[t("i",{class:"fas fa-trash-alt mr-2"},null,-1),i(" ยืนยันการลบ ")])),t("button",{onClick:E,class:"bg-gray-300 text-gray-800 px-6 py-2 rounded-lg font-semibold hover:bg-gray-400 transition duration-300"},e[13]||(e[13]=[t("i",{class:"fas fa-times mr-2"},null,-1),i(" ยกเลิก ")]))])])])):h("",!0)]))}});export{Ft as default};
