import{d as ye,u as he,r as v,l as j,s as ne,M as Ee,c as d,a as u,b as e,e as f,w as ie,k as p,f as $,v as D,n as x,t as c,g as de,F as ue,h as ce,A as W,C as fe,N as De,O as ve,i as J,_ as we,o as Ie,q as pe,m as Te,P as Oe,G as xe,Q as Fe,S as Le}from"./index-C1nZs7mf.mjs";const Re={class:"card bg-gray-50 p-6 rounded-lg shadow-inner mb-8"},Ve={class:"flex items-center justify-between mb-4"},Me=["disabled"],Ae={class:"lg:col-span-2 space-y-4"},qe={class:"mt-1 relative"},ze={class:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-400"},Be={key:0,class:"mt-1 text-sm text-red-600"},Ge=["value"],Ke={key:0,class:"mt-1 text-sm text-red-600"},He={class:"flex justify-between mt-1"},Qe={key:0,class:"text-sm text-red-600"},Ye={class:"text-xs text-gray-400"},Je={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},We=["min"],Xe={key:0,class:"mt-1 text-sm text-red-600"},Ze={key:0},et={key:1},tt={key:0,class:"mt-1 text-xs text-gray-500"},lt={class:"flex justify-end gap-3 pt-2"},st=["disabled"],at={class:"lg:col-span-1"},ot={class:"bg-white border rounded-lg p-4 shadow-sm"},rt={class:"space-y-2"},nt={class:"aspect-video bg-gray-100 rounded-lg overflow-hidden flex items-center justify-center"},it=["src","alt"],dt={key:1,class:"text-gray-400 text-sm flex flex-col items-center"},ut={class:"flex items-center justify-between"},ct={class:"text-xs text-gray-500"},ft={class:"font-semibold mt-1 text-gray-800 line-clamp-2"},vt={class:"text-gray-600 text-sm mt-1 line-clamp-3"},re="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500",gt=ye({__name:"NewsCreateForm",emits:["newsSaved"],setup(ke,{emit:_}){const E=he(),X=new Date(2e3,0,1).toISOString().split("T")[0],A=["procurement","recruitment","forms","staff"],q=["activity","general"];function Z(o,a,i=200){const F=o.trim(),le=a.trim(),V=(F?`${F} — `:"")+le;if(V.length<=i)return V;const K=V.slice(0,i),H=K.lastIndexOf(" ");return(H>0?K.slice(0,H):K)+"…"}function Y(o){if(!o)return"-";try{return new Date(o).toLocaleDateString("th-TH",{year:"numeric",month:"short",day:"numeric"})}catch{return o}}function z(o){return o?/^https?:\/\//i.test(o)?o:`${"https://api.maetaeng.go.th/api/v1".replace(/\/+$/,"").replace(/\/api(\/v\d+)?$/i,"")}/${String(o).replace(/^\/+/,"")}`:""}const N=v(!1),r=v({id:"",title:"",content:"",category:"",excerpt:"",date:new Date().toISOString().split("T")[0],imageUrl:"",pdfUrl:"",isPublished:!1}),b=v(null),P=v(null),U=v(null);let h=null;const g=v({title:null,content:null,date:null,category:null,excerpt:null}),y=v({title:!1,content:!1,date:!1,category:!1,excerpt:!1});function n(o){const a=r.value;o==="title"?g.value.title=a.title.trim()?null:"กรุณากรอกหัวข้อ":o==="content"?g.value.content=a.content.trim()?null:"กรุณากรอกเนื้อหา":o==="date"?g.value.date=a.date?null:"กรุณาเลือกวันที่":o==="category"&&(g.value.category=a.category?null:"กรุณาเลือกหมวดหมู่"),o==="excerpt"&&a.excerpt&&a.excerpt.length>200?g.value.excerpt="คำโปรยต้องไม่เกิน 200 ตัวอักษร":o==="excerpt"&&(g.value.excerpt=null)}function w(o){y.value[o]=!0,n(o)}function C(o){const a=y.value[o]&&!!g.value[o];return`${re} ${a?"border-red-300 focus:border-red-400 focus:ring-red-300":""}`}function I(o){const a=y.value[o]&&!!g.value[o];return`${re} ${a?"border-red-300 focus:border-red-400 focus:ring-red-300":""}`}const S=j(()=>{const o=r.value;return!!(o.title.trim()&&o.content.trim()&&o.date&&o.category)&&!g.value.excerpt}),R=j(()=>U.value?U.value:r.value.imageUrl?z(r.value.imageUrl):""),B=j(()=>A.includes(r.value.category)),G=j(()=>q.includes(r.value.category)||!r.value.category);ne(()=>r.value.category,o=>{A.includes(o)&&(b.value=null,h&&URL.revokeObjectURL(h),U.value=null),q.includes(o)&&(P.value=null)});function ee(o){const a=o.target;if(!a)return;const i="data:image/svg+xml;utf8,"+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="600" height="400"><rect width="100%" height="100%" fill="#e5e7eb"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-family="sans-serif" font-size="18" fill="#4b5563">Image unavailable</text></svg>');a.src!==i&&(a.src=i)}function te(o){const i=o.target.files?.[0]??null;if(b.value=i,h&&URL.revokeObjectURL(h),i){const F=URL.createObjectURL(i);U.value=F,h=F,r.value.imageUrl=""}else U.value=null}function M(o){const a=o.target;P.value=a.files?.[0]??null}const T=_;async function O(){if(Object.keys(r.value).forEach(o=>w(o)),G.value&&!b.value&&!r.value.imageUrl){E.error("กรุณาแนบรูปภาพประกอบ");return}if(!S.value||N.value||Object.values(g.value).some(o=>o!==null)){E.error("กรุณากรอกข้อมูลให้ครบถ้วนและถูกต้อง");return}N.value=!0;try{const o={title:r.value.title.trim(),content:r.value.content.trim(),category:r.value.category,excerpt:(r.value.excerpt?.trim()||Z(r.value.title,r.value.content)).slice(0,200),date:r.value.date},a=await De({...o,image:b.value,pdf:P.value});if(r.value.isPublished)try{await ve(a.id,!0),E.success("สร้างและเผยแพร่ข่าวสารใหม่สำเร็จ!")}catch{E.error("สร้างสำเร็จ แต่เผยแพร่ไม่สำเร็จ")}else E.success("เพิ่มข่าวสารใหม่สำเร็จ!");k(),T("newsSaved")}catch(o){J(o)?E.error(o.response?.data?.message??"บันทึกข่าวสารไม่สำเร็จ"):E.error("บันทึกข่าวสารไม่สำเร็จ")}finally{N.value=!1}}function k(){h&&URL.revokeObjectURL(h),U.value=null,r.value={id:"",title:"",content:"",category:"",excerpt:"",date:new Date().toISOString().split("T")[0],imageUrl:"",pdfUrl:"",isPublished:!1},b.value=null,P.value=null,g.value={title:null,content:null,date:null,category:null,excerpt:null},y.value={title:!1,content:!1,date:!1,category:!1,excerpt:!1}}return Ee(()=>{h&&URL.revokeObjectURL(h)}),(o,a)=>(u(),d("section",Re,[e("div",Ve,[a[11]||(a[11]=e("h3",{class:"text-xl font-semibold text-gray-800"},"เพิ่มข่าวสารใหม่",-1)),e("button",{type:"button",class:"text-sm px-3 py-1.5 rounded-md border border-gray-500 hover:bg-gray-700 transition bg-gray-100 hover:text-white",onClick:k,disabled:N.value,title:"ล้างฟอร์ม"},a[10]||(a[10]=[e("i",{class:"fas fa-undo-alt mr-2"},null,-1),f(" เคลียร์ ")]),8,Me)]),e("form",{onSubmit:ie(O,["prevent"]),class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},[e("div",Ae,[e("div",null,[a[12]||(a[12]=e("label",{for:"newsTitle",class:"block text-sm font-medium text-gray-700"},[f("หัวข้อข่าวสาร "),e("span",{class:"text-red-500"},"*")],-1)),e("div",qe,[$(e("input",{type:"text",id:"newsTitle","onUpdate:modelValue":a[0]||(a[0]=i=>r.value.title=i),onBlur:a[1]||(a[1]=i=>w("title")),class:x(C("title")),placeholder:"เช่น ประกาศวันหยุดราชการ",maxlength:"120",required:""},null,34),[[D,r.value.title,void 0,{trim:!0}]]),e("div",ze,c(r.value.title.length)+"/120 ",1)]),y.value.title&&g.value.title?(u(),d("p",Be,c(g.value.title),1)):p("",!0)]),e("div",null,[a[14]||(a[14]=e("label",{for:"newsCategory",class:"block text-sm font-medium text-gray-700"},[f("หมวดหมู่ข่าวสาร "),e("span",{class:"text-red-500"},"*")],-1)),$(e("select",{id:"newsCategory","onUpdate:modelValue":a[2]||(a[2]=i=>r.value.category=i),onChange:a[3]||(a[3]=i=>w("category")),required:"",class:x(["mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500",C("category")])},[a[13]||(a[13]=e("option",{disabled:"",value:""},"-- กรุณาเลือกหมวดหมู่ --",-1)),(u(!0),d(ue,null,ce(W(fe),i=>(u(),d("option",{key:i.key,value:i.key},c(i.label),9,Ge))),128))],34),[[de,r.value.category]]),y.value.category&&g.value.category?(u(),d("p",Ke,c(g.value.category),1)):p("",!0)]),e("div",null,[a[15]||(a[15]=e("label",{for:"newsContent",class:"block text-sm font-medium text-gray-700"},[f("เนื้อหาข่าวสาร "),e("span",{class:"text-red-500"},"*")],-1)),$(e("textarea",{id:"newsContent","onUpdate:modelValue":a[4]||(a[4]=i=>r.value.content=i),onBlur:a[5]||(a[5]=i=>w("content")),class:x(I("content")),rows:"6",placeholder:"เนื้อหาข่าวโดยย่อ…",maxlength:"2000",required:""},null,34),[[D,r.value.content,void 0,{trim:!0}]]),e("div",He,[y.value.content&&g.value.content?(u(),d("p",Qe,c(g.value.content),1)):p("",!0),e("span",Ye,c(r.value.content.length)+"/2000",1)])]),e("div",null,[a[16]||(a[16]=e("label",{for:"newsExcerpt",class:"block text-sm font-medium text-gray-700"},"คำโปรย (ถ้าเว้นว่าง ระบบจะสร้างให้อัตโนมัติ)",-1)),$(e("input",{id:"newsExcerpt",type:"text","onUpdate:modelValue":a[6]||(a[6]=i=>r.value.excerpt=i),class:x(re),placeholder:"ข้อความสั้น ๆ สรุปข่าว",maxlength:"200"},null,512),[[D,r.value.excerpt,void 0,{trim:!0}]])]),e("div",Je,[e("div",null,[a[17]||(a[17]=e("label",{for:"newsDate",class:"block text-sm font-medium text-gray-700"},[f("วันที่เผยแพร่ "),e("span",{class:"text-red-500"},"*")],-1)),$(e("input",{type:"date",id:"newsDate","onUpdate:modelValue":a[7]||(a[7]=i=>r.value.date=i),onChange:a[8]||(a[8]=i=>w("date")),class:x(C("date")),min:W(X),required:""},null,42,We),[[D,r.value.date]]),y.value.date&&g.value.date?(u(),d("p",Xe,c(g.value.date),1)):p("",!0)]),e("div",null,[a[18]||(a[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"สถานะการเผยแพร่",-1)),e("button",{type:"button",class:x(["inline-flex items-center px-3 py-2 rounded-md border transition select-none",r.value.isPublished?"bg-green-50 border-green-300 text-green-800":"bg-gray-50 border-gray-300 text-gray-700"]),onClick:a[9]||(a[9]=i=>r.value.isPublished=!r.value.isPublished)},[e("i",{class:x(["fas mr-2",r.value.isPublished?"fa-toggle-on":"fa-toggle-off"])},null,2),f(" "+c(r.value.isPublished?"เผยแพร่แล้ว":"ฉบับร่าง"),1)],2)])]),G.value?(u(),d("div",Ze,[a[19]||(a[19]=e("label",{for:"newsImageFile",class:"block text-sm font-medium text-gray-700"},"รูปภาพประกอบ",-1)),e("input",{id:"newsImageFile",type:"file",accept:"image/*",onChange:te,class:"mt-1 block w-full text-sm"},null,32)])):p("",!0),B.value?(u(),d("div",et,[a[20]||(a[20]=e("label",{for:"newsPdfFile",class:"block text-sm font-medium text-gray-700"},"ไฟล์เอกสารแนบ (PDF)",-1)),e("input",{id:"newsPdfFile",type:"file",accept:".pdf, application/pdf",onChange:M,class:"mt-1 block w-full text-sm"},null,32),P.value?(u(),d("p",tt,"ไฟล์ที่เลือก: "+c(P.value.name),1)):p("",!0)])):p("",!0),e("div",lt,[e("button",{type:"submit",class:"bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition disabled:opacity-50",disabled:!S.value||N.value},a[21]||(a[21]=[e("i",{class:"fas fa-save mr-2"},null,-1),f("เพิ่มข่าวสาร ")]),8,st)])]),e("aside",at,[e("div",ot,[a[23]||(a[23]=e("h4",{class:"font-semibold text-gray-800 mb-3"},"พรีวิว",-1)),e("div",rt,[e("div",nt,[R.value?(u(),d("img",{key:0,src:R.value,alt:r.value.title||"รูปภาพพรีวิวข่าว",class:"w-full h-full object-cover",onError:ee},null,40,it)):(u(),d("div",dt,a[22]||(a[22]=[e("i",{class:"far fa-image text-3xl mb-2"},null,-1),f(" ไม่มีรูปภาพ ")])))]),e("div",null,[e("div",ut,[e("span",ct,c(Y(r.value.date)),1),e("span",{class:x(["text-xs px-2 py-0.5 rounded-full whitespace-nowrap",r.value.isPublished?"bg-green-100 text-green-800":"bg-gray-200 text-gray-700"])},c(r.value.isPublished?"เผยแพร่แล้ว":"ฉบับร่าง"),3)]),e("h5",ft,c(r.value.title||"หัวข้อข่าว…"),1),e("p",vt,c(r.value.content||"พิมพ์เนื้อหาข่าวสั้น ๆ เพื่อพรีวิวได้ทันที…"),1)])])])])],32)]))}}),bt=we(gt,[["__scopeId","data-v-6d3205f9"]]),mt={class:"p-6 bg-white rounded-lg shadow-md"},pt={class:"mb-6 flex justify-between items-center"},xt=["disabled"],yt={key:0,class:"mb-4 rounded-md border border-red-200 bg-red-50 p-3 text-red-700 flex items-center justify-between"},ht={class:"flex items-center gap-2"},wt={class:"card bg-white p-6 rounded-lg shadow-md"},kt={class:"flex items-center justify-between mb-5"},_t={class:"flex items-center gap-2"},Ut={class:"relative"},Ct=["title"],$t={class:"overflow-x-auto rounded-lg border border-gray-200"},Pt={class:"min-w-full divide-y divide-gray-200 text-sm"},jt={class:"divide-y divide-gray-100"},Nt={class:"px-4 py-3 text-gray-500"},St={class:"px-4 py-3"},Et={class:"flex items-center gap-3 max-w-xs"},Dt=["src","alt"],It={key:1,class:"w-10 h-10 flex items-center justify-center bg-red-50 rounded text-red-600 border border-red-200"},Tt={key:2,class:"w-10 h-10 flex items-center justify-center bg-gray-100 rounded text-gray-400 border"},Ot={class:"font-medium ..."},Ft={class:"px-4 py-3 text-gray-600"},Lt={class:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-700"},Rt={class:"px-4 py-3 text-gray-600 whitespace-nowrap"},Vt={class:"px-4 py-3"},Mt={class:"px-4 py-3 text-center"},At={class:"flex justify-center gap-2"},qt={class:"flex items-center justify-center"},zt=["for"],Bt=["id","checked","onChange"],Gt=["title"],Kt=["onClick"],Ht=["onClick"],Qt={key:0},Yt={class:"flex items-center justify-between mt-4 text-sm text-gray-600"},Jt={class:"flex items-center gap-2"},Wt=["disabled"],Xt=["disabled"],Zt={class:"bg-white w-full max-w-5xl rounded-2xl overflow-hidden shadow-2xl ring-1 ring-black/10 animate-[fadeIn_.18s_ease-out]"},el={class:"max-h-[75vh] overflow-y-auto px-6 py-6"},tl={key:2,class:"fixed inset-0 bg-gray-700 bg-opacity-50 backdrop-blur-[2px] flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true","aria-labelledby":"confirmTitle"},ll={key:3,class:"fixed inset-0 bg-white/40 backdrop-blur-[1px] z-40 flex items-center justify-center","aria-live":"polite","aria-busy":"true"},sl={class:"bg-white w-full max-w-5xl rounded-2xl overflow-hidden shadow-2xl ring-1 ring-black/10 animate-[fadeIn_.18s_ease-out]"},al={class:"max-h-[75vh] overflow-y-auto px-6 py-6"},ol={class:"lg:col-span-2 space-y-5"},rl={class:"mt-1 relative"},nl={class:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-400"},il=["value"],dl={class:"mt-1 relative"},ul={class:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-400"},cl={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},fl=["min"],vl={key:0},gl={class:"rounded-lg border border-dashed p-4 bg-gray-50 hover:bg-gray-100 transition text-center"},bl={class:"text-sm text-gray-600"},ml={class:"text-blue-600 font-medium cursor-pointer hover:underline"},pl={key:1},xl={key:0,class:"mt-2 text-sm"},yl=["href"],hl={key:1,class:"mt-1 text-xs text-gray-500"},wl={class:"bg-gray-50 border rounded-lg p-4 sticky top-4"},kl={class:"aspect-video bg-gray-100 rounded-lg overflow-hidden flex items-center justify-center"},_l=["src","alt"],Ul={key:1,class:"text-gray-400 text-sm flex flex-col items-center"},Cl={class:"mt-3"},$l={class:"flex items-center justify-between"},Pl={class:"text-xs text-gray-500"},jl={class:"font-semibold mt-1 text-gray-800 line-clamp-2"},Nl={class:"text-gray-600 text-sm mt-1 line-clamp-3"},Sl={class:"sticky bottom-0 bg-white/95 backdrop-blur border-t px-6 py-4"},El={class:"flex items-center justify-end gap-3"},Dl=["disabled"],Il={key:0,class:"inline-flex items-center gap-2"},Tl={key:1},Ol=ye({__name:"DashboardNewsView",setup(ke){const _=he(),E=new Date(2e3,0,1).toISOString().split("T")[0],X=j(()=>Object.fromEntries(fe.map(({key:l,label:t})=>[l,t]))),A=["procurement","recruitment","forms","staff"],q=["activity","general"];function Z(l,t,s=200){const m=l.trim(),L=t.trim(),ae=(m?`${m} — `:"")+L;if(ae.length<=s)return ae;const oe=ae.slice(0,s),me=oe.lastIndexOf(" ");return(me>0?oe.slice(0,me):oe)+"…"}function Y(l){if(!l)return"-";try{return new Date(l).toLocaleDateString("th-TH",{year:"numeric",month:"short",day:"numeric"})}catch{return l}}function z(l){return l?/^https?:\/\//i.test(l)?l:`${"https://api.maetaeng.go.th/api/v1".replace(/\/+$/,"").replace(/\/api(\/v\d+)?$/i,"")}/${String(l).replace(/^\/+/,"")}`:""}function N(l){return new Date(l.updatedAt||l.createdAt||l.date||0).getTime()}function r(l){return[...l].sort((t,s)=>N(s)-N(t))}const b=v([]),P=v(!1),U=v(null),h=v(!1),g=v(!1),y=v(!1),n=v({id:"",title:"",content:"",category:"",excerpt:"",date:new Date().toISOString().split("T")[0],imageUrl:"",pdfUrl:"",isPublished:!1}),w=v(null),C=v(null),I=v(null);let S=null;const R=v(null),B=v(!1),G=j(()=>I.value?I.value:n.value.imageUrl?z(n.value.imageUrl):""),ee=j(()=>A.includes(n.value.category)),te=j(()=>q.includes(n.value.category)||!n.value.category),M=v(""),T=v("updated"),O=v(!1),k=v(1),o=v(10),a=j(()=>{const l=M.value.trim().toLowerCase();return l?b.value.filter(t=>t.title.toLowerCase().includes(l)):b.value}),i=j(()=>{const l=[...a.value],t=O.value?1:-1;return T.value==="updated"?l.sort((s,m)=>(N(s)-N(m))*t):T.value==="date"?l.sort((s,m)=>(new Date(s.date).getTime()-new Date(m.date).getTime())*t):T.value==="title"?l.sort((s,m)=>s.title.localeCompare(m.title)*t):l.sort((s,m)=>(Number(s.isPublished)-Number(m.isPublished))*t),l}),F=j(()=>{const l=(k.value-1)*o.value;return i.value.slice(l,l+o.value)});ne([M,T,O],()=>{k.value=1}),ne(()=>n.value.category,l=>{A.includes(l)&&(w.value=null),q.includes(l)&&(C.value=null)});function le(){h.value=!0}function V(){h.value=!1}function K(){se(),V()}function H(l){const t=l.target;if(!t)return;const s="data:image/svg+xml;utf8,"+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="600" height="400"><rect width="100%" height="100%" fill="#e5e7eb"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-family="sans-serif" font-size="18" fill="#4b5563">Image unavailable</text></svg>');t.src!==s&&(t.src=s)}function _e(l){const t=l.target;if(w.value=t.files?.[0]??null,S&&URL.revokeObjectURL(S),w.value){const s=URL.createObjectURL(w.value);I.value=s,S=s,n.value.imageUrl=""}else I.value=null}function Ue(l){const t=l.target;C.value=t.files?.[0]??null}async function se(){P.value=!0,U.value=null;try{const l=await Oe();b.value=r(xe(l))}catch(l){J(l)?U.value=l.response?.data?.message??l.message:U.value="ไม่สามารถดึงรายการข่าวได้"}finally{P.value=!1}}function Ce(l){return{id:l.id,title:l.title,content:l.content,category:l.category??"general",excerpt:l.excerpt??"",date:l.date,imageUrl:l.imageUrl??"",pdfUrl:l.pdfUrl??"",isPublished:l.isPublished}}function $e(l){S&&URL.revokeObjectURL(S),I.value=null,w.value=null,C.value=null,n.value=Ce(l),g.value=!0}function Q(){g.value=!1,S&&URL.revokeObjectURL(S),I.value=null,w.value=null,C.value=null}async function ge(){if(y.value)return;const l=n.value;if(!l.title.trim()||!l.content.trim()||!l.date||!l.category){_.error("กรุณากรอกข้อมูลให้ครบทุกช่องที่มีเครื่องหมาย *");return}y.value=!0;try{const t={title:l.title.trim(),content:l.content.trim(),category:l.category,excerpt:(l.excerpt?.trim()||Z(l.title,l.content)).slice(0,200),date:l.date};let s=await Fe(l.id,{...t,image:w.value,pdf:C.value});if(s.isPublished!==l.isPublished)try{const L=await ve(l.id,l.isPublished);s={...s,...L}}catch{_.error("บันทึกแล้ว แต่เปลี่ยนสถานะเผยแพร่ไม่สำเร็จ")}const m=b.value.findIndex(L=>String(L.id)===String(l.id));m!==-1&&(b.value[m]={...b.value[m],...xe([s])[0]}),_.success("บันทึกการแก้ไขเรียบร้อย"),b.value=r(b.value),Q()}catch(t){J(t)?_.error(t.response?.data?.message??"บันทึกการแก้ไขไม่สำเร็จ"):_.error("บันทึกการแก้ไขไม่สำเร็จ")}finally{y.value=!1}}function Pe(l){R.value=l,B.value=!0}async function je(){if(!R.value)return;const l=R.value,t=[...b.value];b.value=b.value.filter(s=>s.id!==l);try{await Le(l),_.success("ลบข่าวสารสำเร็จ!")}catch(s){b.value=t,J(s)?_.error(s.response?.data?.message??"ลบข่าวสารไม่สำเร็จ"):_.error("ลบข่าวสารไม่สำเร็จ")}finally{be()}}async function Ne(l){const t=l.isPublished,s=!t;l.isPublished=s;try{const m=await ve(l.id,s);Object.assign(l,m),_.success(s?"เผยแพร่ข่าวแล้ว":"ยกเลิกเผยแพร่แล้ว"),b.value=r(b.value)}catch{l.isPublished=t,_.error("เกิดข้อผิดพลาดในการเปลี่ยนสถานะ")}}function be(){R.value=null,B.value=!1}function Se(){be()}return Ie(se),(l,t)=>(u(),d("div",mt,[e("header",pt,[t[12]||(t[12]=e("div",null,[e("h2",{class:"text-2xl font-bold text-gray-800 mb-2 flex items-center"},[e("i",{class:"fas fa-newspaper mr-3 text-blue-500"}),f(" จัดการข่าวสาร (News Management) ")]),e("p",{class:"text-gray-600"},"เพิ่ม / แก้ไข / สลับสถานะเผยแพร่ข่าวสาร")],-1)),e("button",{type:"button",class:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition flex items-center shadow-md disabled:opacity-50",onClick:le,disabled:P.value},t[11]||(t[11]=[e("i",{class:"fas fa-plus mr-2"},null,-1),f(" เพิ่มข่าวสารใหม่ ")]),8,xt)]),U.value?(u(),d("div",yt,[e("div",ht,[t[13]||(t[13]=e("i",{class:"fas fa-exclamation-triangle"},null,-1)),e("span",null,c(U.value),1)]),e("button",{onClick:se,class:"px-3 py-1 rounded-md border border-red-300 hover:bg-white text-sm"}," ลองใหม่ ")])):p("",!0),e("section",wt,[e("div",kt,[t[16]||(t[16]=e("h3",{class:"text-xl font-semibold text-gray-800 flex items-center gap-2"},[e("i",{class:"fas fa-list text-blue-500"}),f(" รายการข่าวสาร ")],-1)),e("div",_t,[e("div",Ut,[$(e("input",{type:"search","onUpdate:modelValue":t[0]||(t[0]=s=>M.value=s),placeholder:"ค้นหาหัวข้อข่าว...",class:"pl-9 pr-3 py-1.5 text-sm rounded-md border border-gray-300 focus:ring-blue-500 focus:border-blue-500"},null,512),[[D,M.value,void 0,{trim:!0}]]),t[14]||(t[14]=e("i",{class:"fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"},null,-1))]),$(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>T.value=s),class:"border rounded-md text-sm py-1.5 px-2 focus:ring-blue-500 focus:border-blue-500"},t[15]||(t[15]=[e("option",{value:"updated"},"อัปเดตล่าสุด",-1),e("option",{value:"date"},"วันที่",-1),e("option",{value:"title"},"หัวข้อ",-1),e("option",{value:"status"},"สถานะ",-1)]),512),[[de,T.value]]),e("button",{class:"p-2 border rounded-md hover:bg-gray-50",onClick:t[2]||(t[2]=s=>O.value=!O.value),title:O.value?"เรียง น้อย→มาก":"เรียง มาก→น้อย"},[e("i",{class:x(O.value?"fas fa-arrow-up":"fas fa-arrow-down")},null,2)],8,Ct)])]),e("div",$t,[e("table",Pt,[t[22]||(t[22]=e("thead",{class:"bg-gray-50 text-gray-600 uppercase text-xs font-medium"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left w-12"},"#"),e("th",{class:"px-4 py-3 text-left"},"หัวข้อ"),e("th",{class:"px-4 py-3 text-left"},"หมวดหมู่"),e("th",{class:"px-4 py-3 text-left w-32"},"วันที่"),e("th",{class:"px-4 py-3 text-left w-28"},"สถานะ"),e("th",{class:"px-4 py-3 text-center w-40"},"การจัดการ")])],-1)),e("tbody",jt,[(u(!0),d(ue,null,ce(F.value,(s,m)=>(u(),d("tr",{key:s.id,class:"hover:bg-blue-50/40 transition"},[e("td",Nt,c((k.value-1)*o.value+m+1),1),e("td",St,[e("div",Et,[s.imageUrl?(u(),d("img",{key:0,src:z(s.imageUrl),alt:s.title,class:"w-10 h-10 rounded object-cover border",onError:H},null,40,Dt)):s.pdfUrl?(u(),d("div",It,t[17]||(t[17]=[e("i",{class:"fas fa-file-pdf text-xl"},null,-1)]))):(u(),d("div",Tt,t[18]||(t[18]=[e("i",{class:"far fa-image"},null,-1)]))),e("span",Ot,c(s.title),1)])]),e("td",Ft,[e("span",Lt,c(X.value[s.category??"general"]||s.category),1)]),e("td",Rt,c(Y(s.date)),1),e("td",Vt,[e("span",{class:x(["px-2.5 py-1 rounded-full text-xs font-semibold whitespace-nowrap",s.isPublished?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"])},c(s.isPublished?"เผยแพร่แล้ว":"ฉบับร่าง"),3)]),e("td",Mt,[e("div",At,[e("div",qt,[e("label",{for:`toggle-${s.id}`,class:"flex items-center cursor-pointer"},[e("input",{type:"checkbox",id:`toggle-${s.id}`,checked:s.isPublished,onChange:L=>Ne(s),class:"sr-only"},null,40,Bt),e("div",{class:x(["relative w-10 h-5 rounded-full transition duration-300 shadow-inner",s.isPublished?"bg-green-500":"bg-gray-300"]),title:s.isPublished?"สถานะ: เผยแพร่แล้ว":"สถานะ: ซ่อน"},[e("div",{class:x(["absolute left-0.5 top-0.5 w-4 h-4 bg-white rounded-full transition-transform duration-300 shadow-md",{"translate-x-5":s.isPublished}])},[e("i",{class:x(["fas w-full h-full flex items-center justify-center text-xs",s.isPublished?"fa-check text-green-500":"fa-times text-gray-500"])},null,2)],2)],10,Gt)],8,zt)]),e("button",{onClick:L=>$e(s),class:"p-2 rounded-md hover:bg-amber-50 text-amber-600",title:"แก้ไข"},t[19]||(t[19]=[e("i",{class:"fas fa-edit"},null,-1)]),8,Kt),e("button",{onClick:L=>Pe(s.id),class:"p-2 rounded-md hover:bg-red-50 text-red-600",title:"ลบ"},t[20]||(t[20]=[e("i",{class:"fas fa-trash-alt"},null,-1)]),8,Ht)])])]))),128)),F.value.length===0?(u(),d("tr",Qt,t[21]||(t[21]=[e("td",{colspan:"6",class:"py-10 text-center text-gray-500"},[e("i",{class:"fas fa-info-circle mr-2"}),f(" ไม่พบข่าวสาร ")],-1)]))):p("",!0)])])]),e("div",Yt,[e("p",null," แสดง "+c((k.value-1)*o.value+1)+" – "+c(Math.min(k.value*o.value,i.value.length))+" จาก "+c(i.value.length)+" รายการ ",1),e("div",Jt,[e("button",{class:"px-3 py-1 border rounded-md hover:bg-gray-50 disabled:opacity-50",disabled:k.value<=1,onClick:t[3]||(t[3]=s=>k.value--)}," ก่อนหน้า ",8,Wt),e("span",null,"หน้า "+c(k.value),1),e("button",{class:"px-3 py-1 border rounded-md hover:bg-gray-50 disabled:opacity-50",disabled:k.value*o.value>=i.value.length,onClick:t[4]||(t[4]=s=>k.value++)}," ถัดไป ",8,Xt)])])]),h.value?(u(),d("div",{key:1,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/55 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"createNewsTitle",onKeydown:pe(V,["esc"])},[e("div",Zt,[e("header",{class:"sticky top-0 z-10 bg-white/95 backdrop-blur border-b px-6 py-4"},[e("div",{class:"flex items-center justify-between"},[t[24]||(t[24]=e("h3",{id:"createNewsTitle",class:"text-xl font-bold text-gray-900 truncate"}," เพิ่มข่าวสารใหม่ ",-1)),e("button",{class:"w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center",onClick:V,"aria-label":"ปิดหน้าต่างสร้างข่าวสาร"},t[23]||(t[23]=[e("i",{class:"fas fa-times text-gray-700"},null,-1)]))])]),e("div",el,[Te(bt,{onNewsSaved:K})])])],32)):p("",!0),B.value?(u(),d("div",tl,[e("div",{class:"bg-white p-6 rounded-lg shadow-xl max-w-sm w-full text-center"},[t[27]||(t[27]=e("h3",{id:"confirmTitle",class:"text-xl font-bold text-gray-800 mb-3"},"ยืนยันการลบ",-1)),t[28]||(t[28]=e("p",{class:"text-gray-700 mb-6"},"คุณแน่ใจหรือไม่ว่าต้องการลบข่าวสารนี้?",-1)),e("div",{class:"flex justify-center gap-3"},[e("button",{onClick:je,class:"bg-red-600 text-white px-6 py-2 rounded-md hover:bg-red-700 transition"},t[25]||(t[25]=[e("i",{class:"fas fa-trash-alt mr-2"},null,-1),f(" ลบ ")])),e("button",{onClick:Se,class:"bg-gray-400 text-white px-6 py-2 rounded-md hover:bg-gray-500 transition"},t[26]||(t[26]=[e("i",{class:"fas fa-times mr-2"},null,-1),f(" ยกเลิก ")]))])])])):p("",!0),P.value?(u(),d("div",ll,t[29]||(t[29]=[e("div",{class:"animate-spin rounded-full h-10 w-10 border-4 border-gray-300 border-t-blue-500"},null,-1)]))):p("",!0),g.value?(u(),d("div",{key:4,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/55 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"editNewsTitle",onKeydown:pe(Q,["esc"]),onClick:ie(Q,["self"])},[e("div",sl,[e("header",{class:"sticky top-0 z-10 bg-white/95 backdrop-blur border-b px-6 py-4"},[e("div",{class:"flex items-center justify-between"},[t[31]||(t[31]=e("div",{class:"min-w-0"},[e("h3",{id:"editNewsTitle",class:"text-xl font-bold text-gray-900 truncate"}," แก้ไขข่าวสาร "),e("p",{class:"text-xs text-gray-500 mt-0.5"},"ปรับรายละเอียดแล้วกด “บันทึกการแก้ไข”")],-1)),e("button",{class:"w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center",onClick:Q,"aria-label":"ปิดหน้าต่างแก้ไข"},t[30]||(t[30]=[e("i",{class:"fas fa-times text-gray-700"},null,-1)]))])]),e("div",al,[e("form",{onSubmit:ie(ge,["prevent"]),class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},[e("div",ol,[e("div",null,[t[32]||(t[32]=e("label",{for:"editNewsTitle",class:"block text-sm font-medium text-gray-700"},[f("หัวข้อข่าวสาร "),e("span",{class:"text-red-500"},"*")],-1)),e("div",rl,[$(e("input",{id:"editNewsTitle",type:"text","onUpdate:modelValue":t[5]||(t[5]=s=>n.value.title=s),required:"",maxlength:"120",autocomplete:"off",class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 pr-14 focus:ring-blue-500 focus:border-blue-500",placeholder:"เช่น ประกาศวันหยุดราชการ"},null,512),[[D,n.value.title,void 0,{trim:!0}]]),e("span",nl,c((n.value.title??"").length)+"/120",1)])]),e("div",null,[t[34]||(t[34]=e("label",{for:"editNewsCategory",class:"block text-sm font-medium text-gray-700"},[f("หมวดหมู่ข่าวสาร "),e("span",{class:"text-red-500"},"*")],-1)),$(e("select",{id:"editNewsCategory","onUpdate:modelValue":t[6]||(t[6]=s=>n.value.category=s),required:"",class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500"},[t[33]||(t[33]=e("option",{disabled:"",value:""},"-- กรุณาเลือกหมวดหมู่ --",-1)),(u(!0),d(ue,null,ce(W(fe),s=>(u(),d("option",{key:s.key,value:s.key},c(s.label),9,il))),128))],512),[[de,n.value.category]])]),e("div",null,[t[35]||(t[35]=e("label",{for:"editNewsContent",class:"block text-sm font-medium text-gray-700"},[f("เนื้อหาข่าวสาร "),e("span",{class:"text-red-500"},"*")],-1)),$(e("textarea",{id:"editNewsContent","onUpdate:modelValue":t[7]||(t[7]=s=>n.value.content=s),rows:"7",required:"",maxlength:"2000",class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"เนื้อหาข่าวโดยย่อ…"},null,512),[[D,n.value.content,void 0,{trim:!0}]])]),e("div",null,[t[36]||(t[36]=e("label",{for:"editNewsExcerpt",class:"block text-sm font-medium text-gray-700"},"คำโปรย",-1)),e("div",dl,[$(e("input",{id:"editNewsExcerpt",type:"text","onUpdate:modelValue":t[8]||(t[8]=s=>n.value.excerpt=s),maxlength:"200",class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 pr-14 focus:ring-blue-500 focus:border-blue-500",placeholder:"ข้อความสั้น ๆ สรุปข่าว"},null,512),[[D,n.value.excerpt,void 0,{trim:!0}]]),e("span",ul,c((n.value.excerpt??"").length)+"/200",1)])]),e("div",cl,[e("div",null,[t[37]||(t[37]=e("label",{for:"editNewsDate",class:"block text-sm font-medium text-gray-700"},[f("วันที่เผยแพร่ "),e("span",{class:"text-red-500"},"*")],-1)),$(e("input",{id:"editNewsDate",type:"date","onUpdate:modelValue":t[9]||(t[9]=s=>n.value.date=s),min:W(E),required:"",class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500"},null,8,fl),[[D,n.value.date]])]),e("div",null,[t[38]||(t[38]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"สถานะการเผยแพร่",-1)),e("button",{type:"button",class:x(["inline-flex items-center px-3 py-2 rounded-md border transition select-none",n.value.isPublished?"bg-green-50 border-green-300 text-green-800":"bg-gray-50 border-gray-300 text-gray-700"]),onClick:t[10]||(t[10]=s=>n.value.isPublished=!n.value.isPublished)},[e("i",{class:x(["fas mr-2",n.value.isPublished?"fa-toggle-on":"fa-toggle-off"])},null,2),f(" "+c(n.value.isPublished?"เผยแพร่แล้ว":"ฉบับร่าง"),1)],2)])]),te.value?(u(),d("div",vl,[t[41]||(t[41]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"รูปภาพประกอบ",-1)),e("div",gl,[e("p",bl,[t[40]||(t[40]=f(" ลากรูปมาวางที่นี่ หรือ ")),e("label",ml,[t[39]||(t[39]=f("เลือกไฟล์")),e("input",{type:"file",accept:"image/*",class:"sr-only",onChange:_e},null,32)])])])])):p("",!0),ee.value?(u(),d("div",pl,[t[43]||(t[43]=e("label",{for:"editNewsPdfFile",class:"block text-sm font-medium text-gray-700"},"ไฟล์เอกสารแนบ (PDF)",-1)),e("input",{id:"editNewsPdfFile",type:"file",accept:".pdf, application/pdf",onChange:Ue,class:"mt-1 block w-full text-sm"},null,32),n.value.pdfUrl&&!C.value?(u(),d("div",xl,[e("a",{href:z(n.value.pdfUrl),target:"_blank",class:"text-blue-600 hover:underline"},t[42]||(t[42]=[e("i",{class:"fas fa-file-pdf mr-2"},null,-1),f(" ดูไฟล์ PDF ปัจจุบัน ")]),8,yl)])):p("",!0),C.value?(u(),d("p",hl," ไฟล์ใหม่ที่เลือก: "+c(C.value.name),1)):p("",!0)])):p("",!0)]),e("aside",null,[e("div",wl,[t[45]||(t[45]=e("h4",{class:"font-semibold text-gray-800 mb-3"},"พรีวิว",-1)),e("div",kl,[G.value?(u(),d("img",{key:0,src:G.value,alt:n.value.title||"รูปภาพพรีวิวข่าว",class:"w-full h-full object-cover",onError:H},null,40,_l)):(u(),d("div",Ul,t[44]||(t[44]=[e("i",{class:"far fa-image text-3xl mb-2"},null,-1),f("ไม่มีรูปภาพ ")])))]),e("div",Cl,[e("div",$l,[e("span",Pl,c(Y(n.value.date)),1),e("span",{class:x(["text-xs px-2 py-0.5 rounded-full whitespace-nowrap",n.value.isPublished?"bg-green-100 text-green-800":"bg-gray-200 text-gray-700"])},c(n.value.isPublished?"เผยแพร่แล้ว":"ฉบับร่าง"),3)]),e("h5",jl,c(n.value.title||"หัวข้อข่าว…"),1),e("p",Nl,c(n.value.content||"พิมพ์เนื้อหาข่าวสั้น ๆ เพื่อพรีวิวได้ทันที…"),1)])])])],32)]),e("footer",Sl,[e("div",El,[e("button",{type:"button",onClick:Q,class:"px-5 py-2 rounded-md border bg-white hover:bg-gray-50"}," ยกเลิก "),e("button",{onClick:ge,class:"bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition disabled:opacity-50",disabled:y.value},[y.value?(u(),d("span",Il,t[46]||(t[46]=[e("span",{class:"h-4 w-4 border-2 border-white/60 border-t-transparent rounded-full inline-block animate-spin"},null,-1),f("กำลังบันทึก… ")]))):(u(),d("span",Tl,t[47]||(t[47]=[e("i",{class:"fas fa-save mr-2"},null,-1),f(" บันทึกการแก้ไข")])))],8,Dl)])])])],32)):p("",!0)]))}}),Ll=we(Ol,[["__scopeId","data-v-ec2826f1"]]);export{Ll as default};
