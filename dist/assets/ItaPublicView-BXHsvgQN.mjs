import{d as B,u as M,r as m,l as w,o as V,c as n,a as l,b as a,k as v,e as x,f as Q,g as N,F as y,h as g,t as c,n as O,w as Y}from"./index-C1nZs7mf.mjs";import{i as j}from"./itaService-Dn7tRidB.mjs";const z={class:"container mx-auto px-4 py-8"},E={key:0,class:"mb-8 flex justify-center items-center space-x-4"},P=["value"],W={key:1,class:"text-center py-20"},G={key:2,class:"text-center py-20 text-red-600"},H={class:"text-xl"},L={key:3,class:"text-center py-20 text-gray-500 text-2xl"},U={key:4,class:"space-y-10"},J={class:"text-2xl font-bold text-my-custom-gray mb-4"},K={key:0,class:"text-gray-600 mb-6 italic"},R={class:"space-y-6"},X=["onClick"],Z={key:0,class:"space-y-4 ml-4"},q={class:"text-lg font-semibold text-gray-800 mb-2"},ee={class:"list-disc pl-6"},te=["onClick"],se={key:1,class:"text-gray-800"},ne={key:2,class:"text-sm text-gray-500 italic"},le={key:0,class:"text-gray-500 italic"},ue=B({__name:"ItaPublicView",setup(ae){const A=M(),b=m([]),h=m(!0),f=m(null),d=m(null),p=m({}),_=w(()=>{const s=new Set((b.value??[]).map(e=>e.year));return Array.from(s).sort((e,t)=>parseInt(t)-parseInt(e))}),k=w(()=>d.value?(b.value??[]).find(s=>s.year===d.value)??null:null),C=w(()=>{if(!k.value)return[];const s=k.value.moits.map(e=>{const t={};for(const o of e.documents??[]){const r=o.sub_topic||"เอกสารทั่วไป";(t[r]??=[]).push(o)}return{...e,groupedDocuments:t}});return s.sort((e,t)=>{const o=parseInt(e.moit_name.match(/\d+/)?.[0]??"0"),r=parseInt(t.moit_name.match(/\d+/)?.[0]??"0");return o-r}),s}),$=s=>s?s.match(/\d+/)?.[0]??s:void 0,D=(s,e)=>{const t=s??[],o=String(e),r={};for(const i of t){if($(i.quarter)!==o)continue;const u=i.sub_topic||"เอกสารทั่วไป";(r[u]??=[]).push(i)}return r},I=(s,e)=>{const t=s??[],o=String(e);return t.some(r=>$(r.quarter)===o)},T=(s,e)=>{const t=`${s}-${e}`,o=!!p.value[t],r={};for(const i in p.value)i.startsWith(`${s}-`)||(r[i]=p.value[i]);o||(r[t]=!0),p.value=r},F=async()=>{h.value=!0,f.value=null;try{const s=await j.getAllTopics();b.value=s,_.value.length>0?d.value=_.value[0]:d.value=null}catch(s){f.value=s instanceof Error?s.message:"เกิดข้อผิดพลาดที่ไม่คาดคิด",A.error(f.value)}finally{h.value=!1}},S=(s,e)=>{if(console.log("Opening file:",{fileUrl:s,title:e}),!s){A.error("ไม่พบลิงก์ไฟล์");return}window.open(s,"_blank","noopener,noreferrer")};return V(F),(s,e)=>(l(),n("div",z,[e[8]||(e[8]=a("h1",{class:"text-4xl font-extrabold text-my-custom-teal mb-8 text-center"},[x(" การประเมินคุณธรรมและความโปร่งใส "),a("br"),x("(MOPH ITA) ")],-1)),_.value.length>0?(l(),n("div",E,[e[1]||(e[1]=a("label",{for:"yearFilter",class:"text-lg font-semibold text-gray-700"},"เลือกปีงบประมาณ:",-1)),Q(a("select",{id:"yearFilter","onUpdate:modelValue":e[0]||(e[0]=t=>d.value=t),class:"p-3 border rounded-lg shadow-sm focus:ring-teal-500 focus:border-teal-500 text-lg"},[(l(!0),n(y,null,g(_.value,t=>(l(),n("option",{key:t,value:t}," ปีงบประมาณ "+c(t),9,P))),128))],512),[[N,d.value]])])):v("",!0),h.value?(l(),n("div",W,e[2]||(e[2]=[a("i",{class:"fas fa-spinner fa-spin text-5xl text-teal-500"},null,-1),a("p",{class:"mt-6 text-xl text-gray-600"},"กำลังโหลดข้อมูล ITA...",-1)]))):f.value?(l(),n("div",G,[e[3]||(e[3]=a("i",{class:"fas fa-exclamation-triangle text-5xl mb-6"},null,-1)),a("p",H,"เกิดข้อผิดพลาดในการดึงข้อมูล: "+c(f.value),1)])):k.value?(l(),n("div",U,[(l(!0),n(y,null,g(C.value,t=>(l(),n("div",{key:t.id,class:"bg-white rounded-xl shadow-lg p-8"},[a("h2",J,[e[5]||(e[5]=a("i",{class:"fas fa-folder mr-3 text-emerald-600"},null,-1)),x(" "+c(t.moit_name)+" "+c(t.title),1)]),t.description?(l(),n("p",K,c(t.description),1)):v("",!0),a("div",R,[(l(),n(y,null,g([1,2,3,4],o=>a("div",{key:o},[a("h3",{onClick:r=>T(t.id,o),class:"text-xl font-semibold text-gray-700 mb-3 border-b pb-2 flex justify-between items-center cursor-pointer"},[a("span",null,[e[6]||(e[6]=a("i",{class:"fas fa-calendar-alt mr-2 text-orange-500"},null,-1)),x(" ไตรมาสที่ "+c(o),1)]),a("i",{class:O(["fas fa-chevron-down transition-transform duration-300",{"rotate-180":p.value[`${t.id}-${o}`]}])},null,2)],8,X),p.value[`${t.id}-${o}`]?(l(),n("div",Z,[(l(!0),n(y,null,g(D(t.documents,o),(r,i)=>(l(),n("div",{key:i},[a("h4",q,[e[7]||(e[7]=a("i",{class:"fas fa-tags mr-2"},null,-1)),x(" "+c(i||"เอกสารทั่วไป"),1)]),a("ul",ee,[(l(!0),n(y,null,g(r,u=>(l(),n("li",{key:u.id,class:"mb-2"},[u.fileUrl?(l(),n("a",{key:0,href:"#",class:"text-teal-600 hover:underline",onClick:Y(oe=>S(u.fileUrl,u.title),["prevent"])},c(u.title),9,te)):(l(),n("span",se,c(u.title),1)),u.description?(l(),n("p",ne,c(u.description),1)):v("",!0)]))),128))])]))),128)),I(t.documents,o)?v("",!0):(l(),n("div",le," ยังไม่มีเอกสารสำหรับไตรมาสนี้ "))])):v("",!0)])),64))])]))),128))])):(l(),n("div",L,e[4]||(e[4]=[a("i",{class:"fas fa-folder-open text-5xl mb-6"},null,-1),a("p",null,"ไม่พบข้อมูล ITA สำหรับปีงบประมาณที่เลือก",-1)])))]))}});export{ue as default};
