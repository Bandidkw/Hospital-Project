import{d as I,r as u,s as L,p as z,a as r,D as O,c as p,k as D,b as e,w as _,t as v,f as h,v as k,T as R,e as d,n as H,U as G,_ as S,u as J,o as K,m as Q,F as W,h as X,H as F}from"./index-C1nZs7mf.mjs";import{a as Y,u as Z,c as ee,d as te}from"./personnelService-CKgtRLDa.mjs";const se={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 transition-opacity"},le={class:"flex justify-between items-center border-b pb-3 mb-4"},ae={class:"text-2xl font-bold text-gray-800"},oe={class:"flex items-center space-x-4"},ne=["required"],ie={key:0,class:"text-sm text-gray-500 mt-2"},re=["href"],de=["src"],ue={class:"flex justify-end space-x-3 pt-4"},pe=["disabled"],ce=I({__name:"PersonnelFormModal",props:{isOpen:{type:Boolean},personnelData:{},editing:{type:Boolean},isSaving:{type:Boolean}},emits:["close","save"],setup(C,{emit:c}){const f=C,m=c,a=u({...f.personnelData});L(()=>f.personnelData,o=>{a.value={...o}},{deep:!0});function x(o){return o?/^https?:\/\//i.test(o)?o:`${"https://api.maetaeng.go.th/api/v1".replace(/\/+$/,"").replace(/\/api(\/v\d+)?$/i,"")}/${String(o).replace(/^\/+/,"")}`:"https://placehold.co/100x100/e0e0e0/333333?text=N/A"}const y=o=>{const t=o.target;if(t.files&&t.files[0]){const n=t.files[0];a.value.imageFile=n;const g=new FileReader;g.onload=w=>{a.value.imageUrl=w.target?.result},g.readAsDataURL(n)}else a.value.imageFile=null,f.editing||(a.value.imageUrl=null)},b=()=>{m("save",a.value)};return(o,t)=>(r(),z(G,{name:"modal-fade"},{default:O(()=>[o.isOpen?(r(),p("div",se,[e("div",{class:"bg-white p-6 rounded-xl shadow-xl max-w-2xl w-full mx-4",onClick:t[7]||(t[7]=_(()=>{},["stop"]))},[e("div",le,[e("h3",ae,v(o.editing?"แก้ไขข้อมูลบุคลากร":"เพิ่มบุคลากรใหม่"),1),e("button",{onClick:t[0]||(t[0]=n=>m("close")),class:"text-gray-500 hover:text-gray-800"},t[8]||(t[8]=[e("i",{class:"fas fa-times text-xl"},null,-1)]))]),e("form",{onSubmit:_(b,["prevent"]),class:"space-y-4"},[e("div",null,[t[9]||(t[9]=e("label",{for:"personnelName",class:"block text-sm font-medium text-gray-700"},"ชื่อ-นามสกุล:",-1)),h(e("input",{type:"text",id:"personnelName","onUpdate:modelValue":t[1]||(t[1]=n=>a.value.name=n),class:"input-field",required:""},null,512),[[k,a.value.name]])]),e("div",null,[t[10]||(t[10]=e("label",{for:"position",class:"block text-sm font-medium text-gray-700"},"ตำแหน่งราชการ:",-1)),h(e("input",{type:"text",id:"position","onUpdate:modelValue":t[2]||(t[2]=n=>a.value.position=n),class:"input-field",required:""},null,512),[[k,a.value.position]])]),e("div",null,[t[11]||(t[11]=e("label",{for:"specialty",class:"block text-sm font-medium text-gray-700"},"ความเชี่ยวชาญ/หัวหน้ากลุ่มงาน:",-1)),h(e("input",{type:"text",id:"specialty","onUpdate:modelValue":t[3]||(t[3]=n=>a.value.specialty=n),class:"input-field"},null,512),[[k,a.value.specialty]])]),e("div",null,[t[12]||(t[12]=e("label",{for:"tel",class:"block text-sm font-medium text-gray-700"},"เบอร์โทรภายใน:",-1)),h(e("input",{type:"text",id:"tel","onUpdate:modelValue":t[4]||(t[4]=n=>a.value.tel=n),class:"input-field"},null,512),[[k,a.value.tel]])]),e("div",oe,[h(e("input",{type:"checkbox",id:"isDirector","onUpdate:modelValue":t[5]||(t[5]=n=>a.value.isDirector=n),class:"h-4 w-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500"},null,512),[[R,a.value.isDirector]]),t[13]||(t[13]=e("label",{for:"isDirector",class:"text-sm font-medium text-gray-700"},"เป็นผู้บริหาร/ผู้อำนวยการ",-1))]),e("div",null,[t[15]||(t[15]=e("label",{for:"personnelImage",class:"block text-sm font-medium text-gray-700"},"รูปภาพบุคลากร:",-1)),e("input",{type:"file",id:"personnelImage",onChange:y,accept:"image/*",class:"mt-1 block w-full text-gray-700",required:!o.editing&&!a.value.imageUrl},null,40,ne),a.value.imageUrl?(r(),p("p",ie,[t[14]||(t[14]=d(" รูปภาพปัจจุบัน: ")),e("a",{href:x(a.value.imageUrl),target:"_blank",class:"text-blue-500 hover:underline"},"ดูรูป",8,re),e("img",{src:x(a.value.imageUrl),alt:"รูปภาพตัวอย่าง",class:"w-16 h-16 object-cover rounded-full mt-2"},null,8,de)])):D("",!0)]),e("div",ue,[e("button",{type:"button",onClick:t[6]||(t[6]=n=>m("close")),class:"btn-secondary"},t[16]||(t[16]=[e("i",{class:"fas fa-times mr-2"},null,-1),d(" ยกเลิก ")])),e("button",{type:"submit",class:"btn-primary",disabled:o.isSaving},[e("i",{class:H(["fas fa-save mr-2",{"fa-spin":o.isSaving,"fa-save":!o.isSaving}])},null,2),d(" "+v(o.editing?"บันทึกการแก้ไข":"เพิ่มบุคลากร"),1)],8,pe)])],32)])])):D("",!0)]),_:1}))}}),fe=S(ce,[["__scopeId","data-v-22f2b2e5"]]),me={class:"p-6 bg-white rounded-xl shadow-lg"},xe={class:"card bg-white p-6 rounded-lg shadow-md"},ve={class:"overflow-x-auto"},ge={class:"min-w-full bg-white border border-gray-200 rounded-lg"},ye={class:"text-gray-600 text-sm font-light"},be={key:0},we={key:1},he={colspan:"6",class:"py-8 text-center text-red-500"},ke={key:2},De={class:"py-3 px-6 text-left"},$e={class:"py-3 px-6 text-left"},Ce=["src"],Pe={class:"py-3 px-6 text-left"},Ue={key:0,class:"ml-2 text-xs font-bold text-purple-600"},_e={class:"py-3 px-6 text-left"},Fe={class:"py-3 px-6 text-left"},Ie={class:"py-3 px-6 text-center"},Se=["onClick"],Me=["onClick"],Ve={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50"},Ne=I({__name:"DashboardPersonnelView",setup(C){const c=J(),f=u([]),m=u(!0),a=u(null),x=u(!1),y=u(!1),b={id:"",name:"",position:"",specialty:void 0,tel:void 0,imageUrl:null,isDirector:!1,imageFile:null},o=u({...b}),t=u(!1),n=u(null),g=u(!1),w=async()=>{m.value=!0,a.value=null;try{const l=await Y();f.value=l}catch(l){console.error("Failed to fetch personnel:",l),a.value="ไม่สามารถโหลดข้อมูลบุคลากรได้ (โปรดตรวจสอบการเชื่อมต่อ API/สิทธิ์)"}finally{m.value=!1}};K(w);const M=()=>{o.value={...b},t.value=!1,x.value=!0},V=l=>{o.value={...l,imageFile:null},t.value=!0,x.value=!0},N=async l=>{y.value=!0;try{if(t.value){if(!l.id)throw new Error("Personnel ID is missing for update.");await Z(l.id,l),c.success("แก้ไขข้อมูลบุคลากรสำเร็จ!")}else await ee(l),c.success("เพิ่มบุคลากรสำเร็จ!");await w(),P()}catch(s){let i="เกิดข้อผิดพลาดในการบันทึกข้อมูล";F(s)&&s.response?.data&&(i=s.response.data.message||"การบันทึกข้อมูลล้มเหลว"),c.error(i),console.error("Save failed:",s)}finally{y.value=!1}},P=()=>{x.value=!1;const l=document.getElementById("personnelImage");l&&(l.value=""),A()},j=l=>{n.value=l,g.value=!0},B=async()=>{if(!n.value){$();return}try{await te(n.value),c.success("ลบข้อมูลบุคลากรสำเร็จ!"),await w()}catch(l){let s="เกิดข้อผิดพลาดในการลบข้อมูล";F(l)&&l.response?.data&&(s=l.response.data.message||"การลบข้อมูลล้มเหลว"),c.error(s),console.error("Delete failed:",l)}finally{$()}},A=()=>{o.value={...b},t.value=!1},$=()=>{n.value=null,g.value=!1},T=()=>{$()};function q(l){return l?/^https?:\/\//i.test(l)?l:`${"https://api.maetaeng.go.th/api/v1".replace(/\/+$/,"").replace(/\/api(\/v\d+)?$/i,"")}/${String(l).replace(/^\/+/,"")}`:"https://placehold.co/100x100/e0e0e0/333333?text=N/A"}return(l,s)=>(r(),p("div",me,[s[11]||(s[11]=e("h2",{class:"text-3xl font-bold text-gray-800 mb-6 flex items-center border-b pb-2"},[e("i",{class:"fas fa-users mr-3 text-purple-600"}),d(" จัดการบุคลากร ")],-1)),s[12]||(s[12]=e("p",{class:"text-gray-700 mb-6"},"หน้านี้ใช้สำหรับเพิ่ม, แก้ไข, และลบข้อมูลบุคลากรของโรงพยาบาล.",-1)),e("div",{class:"mb-6 flex justify-end"},[e("button",{onClick:M,class:"btn-primary"},s[0]||(s[0]=[e("i",{class:"fas fa-plus mr-2"},null,-1),d(" เพิ่มบุคลากรใหม่ ")]))]),Q(fe,{"is-open":x.value,"personnel-data":o.value,editing:t.value,"is-saving":y.value,onClose:P,onSave:N},null,8,["is-open","personnel-data","editing","is-saving"]),e("div",xe,[s[6]||(s[6]=e("h3",{class:"text-xl font-semibold text-gray-800 mb-4"},"รายการบุคลากร",-1)),e("div",ve,[e("table",ge,[s[5]||(s[5]=e("thead",null,[e("tr",{class:"bg-gray-100 text-left text-gray-600 uppercase text-sm leading-normal"},[e("th",{class:"py-3 px-6 text-left"},"#"),e("th",{class:"py-3 px-6 text-left"},"รูปภาพ"),e("th",{class:"py-3 px-6 text-left"},"ชื่อ-นามสกุล"),e("th",{class:"py-3 px-6 text-left"},"ตำแหน่ง"),e("th",{class:"py-3 px-6 text-left"},"ความเชี่ยวชาญ"),e("th",{class:"py-3 px-6 text-center"},"การจัดการ")])],-1)),e("tbody",ye,[m.value?(r(),p("tr",be,s[1]||(s[1]=[e("td",{colspan:"6",class:"py-8 text-center text-gray-500"},[e("i",{class:"fas fa-spinner fa-spin mr-2"}),d("กำลังโหลดข้อมูล... ")],-1)]))):a.value?(r(),p("tr",we,[e("td",he,v(a.value),1)])):f.value.length===0?(r(),p("tr",ke,s[2]||(s[2]=[e("td",{colspan:"6",class:"py-8 text-center text-gray-500"},"ยังไม่มีข้อมูลบุคลากร.",-1)]))):(r(!0),p(W,{key:3},X(f.value,(i,U)=>(r(),p("tr",{key:i.id,class:"border-b border-gray-200 hover:bg-gray-50"},[e("td",De,v(U+1),1),e("td",$e,[e("img",{src:i.imageUrl?q(i.imageUrl):"https://placehold.co/50x50/e0e0e0/333333?text=N/A",alt:"Personnel Image",class:"w-12 h-12 object-cover rounded-full"},null,8,Ce)]),e("td",Pe,[d(v(i.name)+" ",1),i.isDirector?(r(),p("span",Ue,"(Director)")):D("",!0)]),e("td",_e,v(i.position),1),e("td",Fe,v(i.specialty),1),e("td",Ie,[e("button",{onClick:E=>V(i),class:"btn-action-edit mr-2"},s[3]||(s[3]=[e("i",{class:"fas fa-edit"},null,-1),d(" แก้ไข ")]),8,Se),e("button",{onClick:E=>j(i.id),class:"btn-action-delete"},s[4]||(s[4]=[e("i",{class:"fas fa-trash-alt"},null,-1),d(" ลบ ")]),8,Me)])]))),128))])])])]),g.value?(r(),p("div",Ve,[e("div",{class:"bg-white p-6 rounded-lg shadow-xl max-w-sm w-full text-center"},[s[9]||(s[9]=e("h3",{class:"text-xl font-bold text-gray-800 mb-4"},"ยืนยันการลบ",-1)),s[10]||(s[10]=e("p",{class:"text-gray-700 mb-6"},"คุณแน่ใจหรือไม่ว่าต้องการลบข้อมูลบุคลากรนี้?",-1)),e("div",{class:"flex justify-center space-x-4"},[e("button",{onClick:B,class:"btn-confirm-delete"},s[7]||(s[7]=[e("i",{class:"fas fa-trash-alt mr-2"},null,-1),d(" ลบ ")])),e("button",{onClick:T,class:"btn-secondary"},s[8]||(s[8]=[e("i",{class:"fas fa-times mr-2"},null,-1),d(" ยกเลิก ")]))])])])):D("",!0)]))}}),Ae=S(Ne,[["__scopeId","data-v-9adc83cc"]]);export{Ae as default};
