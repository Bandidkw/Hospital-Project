import{d as S,y as A,u as B,r,o as E,c as n,a as i,b as e,k as h,e as u,t as p,F as N,h as U,w as q,f as k,v as C}from"./index-C1nZs7mf.mjs";import{i as y}from"./itaService-Dn7tRidB.mjs";const z={class:"container mx-auto p-8 bg-white rounded-lg shadow-xl"},O={key:0,class:"text-center py-16"},L={key:1,class:"text-center py-16 bg-red-50 p-8 rounded-lg"},R={class:"text-xl text-red-600"},G={key:2,class:"overflow-x-auto rounded-lg border border-gray-200 shadow-sm"},H={class:"min-w-full divide-y divide-gray-200"},J={class:"bg-white divide-y divide-gray-200"},K={key:0},P={class:"px-6 py-4 whitespace-nowrap text-gray-700 font-semibold"},Q={class:"px-6 py-4 text-gray-700"},W={class:"px-6 py-4 text-gray-500 italic"},X={class:"px-6 py-4 whitespace-nowrap text-center text-sm font-medium space-x-2"},Z=["onClick"],ee=["onClick"],te=["onClick"],se={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-50"},le={class:"bg-white rounded-lg shadow-xl p-8 max-w-md w-full"},oe={class:"text-gray-700 mb-6 text-lg"},ae={class:"text-black"},re={key:3,class:"fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-50"},ne={class:"bg-white rounded-lg shadow-xl p-8 max-w-md w-full"},ie={class:"text-2xl font-bold text-gray-800 mb-6"},de=["disabled"],fe=S({__name:"ItaDashboardView",setup(ue){const $=A(),a=B(),g=r([]),b=r(!0),c=r(null),x=r(!1),f=r(!1),v=r(null),l=r({year:new Date().getFullYear()+543,title:"",description:""}),m=r(!1),d=r(null),w=async()=>{b.value=!0,c.value=null;try{g.value=await y.getYears()}catch(s){s instanceof Error?c.value=s.message:c.value="เกิดข้อผิดพลาดที่ไม่คาดคิด",a.error(c.value||"ไม่สามารถดึงข้อมูลปีได้")}finally{b.value=!1}},M=async()=>{if(!l.value.year||!l.value.title){a.error("กรุณากรอกปีและชื่อเรื่องให้ครบถ้วน");return}try{if(f.value&&v.value){const s={title:l.value.title,description:l.value.description||""};a.info(`กำลังอัปเดตข้อมูลปี ${l.value.year}...`),await y.updateYear(v.value,s),a.success(`อัปเดตข้อมูลปี ${l.value.year} สำเร็จ!`)}else{const s={year:String(l.value.year),title:l.value.title,description:l.value.description||""};a.info(`กำลังสร้างปีงบประมาณ ${s.year}...`),await y.createYear(s),a.success(`สร้างปี ${s.year} สำเร็จ!`)}D(),await w()}catch(s){s instanceof Error?a.error(s.message):a.error("เกิดข้อผิดพลาดที่ไม่คาดคิด")}},T=async()=>{if(d.value)try{a.info(`กำลังลบ "${d.value.title}"...`),await y.deleteYear(d.value.id),a.success(`ลบ "${d.value.title}" สำเร็จ!`),_(),await w()}catch(s){s instanceof Error?a.error(s.message):a.error("เกิดข้อผิดพลาดในการลบปีงบประมาณ")}},V=()=>{f.value=!1;const s=new Date().getFullYear()+543;l.value={year:s,title:`ปีงบประมาณ ${s}`,description:`รายละเอียดข้อมูล ITA ประจำปีงบประมาณ ${s}`},x.value=!0},F=s=>{f.value=!0,v.value=s.id,l.value={year:parseInt(s.year),title:s.title||"",description:s.description||""},x.value=!0},D=()=>{x.value=!1},I=s=>{d.value=s,m.value=!0},_=()=>{m.value=!1,d.value=null},j=s=>{$.push(`/dashboard/ita/year/${s}/topics`)};return E(()=>{w()}),(s,t)=>(i(),n("div",z,[e("div",{class:"flex justify-between items-center mb-8 border-b-4 border-blue-500 pb-4"},[t[4]||(t[4]=e("div",null,[e("h1",{class:"text-4xl font-extrabold text-blue-800"},"Dashboard: จัดการปีงบประมาณ ITA"),e("p",{class:"text-gray-600 mt-2 text-lg"},"สร้างหรือจัดการปีงบประมาณสำหรับเอกสาร ITA")],-1)),e("button",{onClick:V,class:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full focus:outline-none focus:shadow-outline transform transition duration-300 hover:scale-105 shadow-lg flex items-center"},t[3]||(t[3]=[e("i",{class:"fas fa-plus mr-2"},null,-1),u(" สร้างปีใหม่ ")]))]),b.value?(i(),n("div",O,t[5]||(t[5]=[e("i",{class:"fas fa-spinner fa-spin text-4xl text-blue-500"},null,-1),e("p",{class:"mt-4 text-xl text-gray-600"},"กำลังโหลดรายการปีงบประมาณ...",-1)]))):c.value?(i(),n("div",L,[e("p",R,"เกิดข้อผิดพลาด: "+p(c.value),1)])):(i(),n("div",G,[e("table",H,[t[10]||(t[10]=e("thead",{class:"bg-blue-100"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-1/6"}," ปีงบประมาณ (พ.ศ.) "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-2/5"}," ชื่อเรื่อง (Title) "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-2/5"}," คำอธิบาย (Description) "),e("th",{class:"px-6 py-3 text-center text-xs font-medium text-gray-600 uppercase tracking-wider"}," การจัดการ ")])],-1)),e("tbody",J,[g.value.length===0?(i(),n("tr",K,t[6]||(t[6]=[e("td",{colspan:"4",class:"px-6 py-4 text-center text-gray-500"}," ยังไม่มีปีงบประมาณในระบบ ",-1)]))):h("",!0),(i(!0),n(N,null,U(g.value,o=>(i(),n("tr",{key:o.id,class:"hover:bg-gray-50"},[e("td",P,p(o.year),1),e("td",Q,p(o.title),1),e("td",W,p(o.description||"-"),1),e("td",X,[e("button",{onClick:Y=>j(o.id),class:"inline-flex items-center px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-md shadow-sm hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors duration-200"},t[7]||(t[7]=[e("i",{class:"fas fa-folder-open mr-2"},null,-1),u(" จัดการหัวข้อ ")]),8,Z),e("button",{onClick:Y=>F(o),class:"inline-flex items-center px-4 py-2 bg-yellow-400 text-gray-700 text-sm font-medium rounded-md hover:bg-yellow-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-400 transition-colors duration-200"},t[8]||(t[8]=[e("i",{class:"fas fa-pencil-alt mr-2"},null,-1),u(" แก้ไข ")]),8,ee),e("button",{onClick:Y=>I(o),class:"inline-flex items-center px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-600 transition-colors duration-200"},t[9]||(t[9]=[e("i",{class:"far fa-trash-alt mr-2"},null,-1),u(" ลบ ")]),8,te)])]))),128))])]),m.value?(i(),n("div",se,[e("div",le,[t[15]||(t[15]=e("h3",{class:"text-2xl font-bold text-red-700 mb-4 flex items-center"},[e("i",{class:"fas fa-exclamation-triangle mr-3"}),u("ยืนยันการลบ ")],-1)),e("p",oe,[t[11]||(t[11]=u(" คุณแน่ใจหรือไม่ว่าต้องการลบ ")),e("strong",ae,'"'+p(d.value?.title)+'"',1),t[12]||(t[12]=u("? ")),t[13]||(t[13]=e("br",null,null,-1)),t[14]||(t[14]=e("span",{class:"text-sm text-red-600"},"การกระทำนี้จะลบหัวข้อและเอกสารทั้งหมดที่อยู่ภายใน และไม่สามารถกู้คืนได้",-1))]),e("div",{class:"flex justify-end space-x-4"},[e("button",{onClick:_,class:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-5 rounded-full"}," ยกเลิก "),e("button",{onClick:T,class:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-5 rounded-full"}," ยืนยันการลบ ")])])])):h("",!0)])),x.value?(i(),n("div",re,[e("div",ne,[e("h2",ie,p(f.value?"แก้ไขปีงบประมาณ":"สร้างปีงบประมาณใหม่"),1),e("form",{onSubmit:q(M,["prevent"]),class:"space-y-4"},[e("div",null,[t[16]||(t[16]=e("label",{for:"year-input",class:"block text-gray-700 font-bold mb-2"},"ปีงบประมาณ (พ.ศ.):*",-1)),k(e("input",{id:"year-input",type:"number","onUpdate:modelValue":t[0]||(t[0]=o=>l.value.year=o),placeholder:"เช่น 2568",class:"shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700",disabled:f.value,required:""},null,8,de),[[C,l.value.year]])]),e("div",null,[t[17]||(t[17]=e("label",{for:"year-title",class:"block text-gray-700 font-bold mb-2"},"ชื่อเรื่อง (Title):*",-1)),k(e("input",{id:"year-title",type:"text","onUpdate:modelValue":t[1]||(t[1]=o=>l.value.title=o),class:"shadow rounded-lg w-full py-3 px-4",required:""},null,512),[[C,l.value.title]])]),e("div",null,[t[18]||(t[18]=e("label",{for:"year-desc",class:"block text-gray-700 font-bold mb-2"},"คำอธิบาย (Description):",-1)),k(e("textarea",{id:"year-desc","onUpdate:modelValue":t[2]||(t[2]=o=>l.value.description=o),rows:"3",class:"shadow rounded-lg w-full py-3 px-4"},null,512),[[C,l.value.description]])]),e("div",{class:"flex justify-end space-x-4 pt-6 mt-4 border-t"},[e("button",{type:"button",onClick:D,class:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6 rounded-full"}," ยกเลิก "),t[19]||(t[19]=e("button",{type:"submit",class:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-full"}," บันทึก ",-1))])],32)])])):h("",!0)]))}});export{fe as default};
