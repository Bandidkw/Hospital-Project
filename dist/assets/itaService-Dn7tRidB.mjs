import{x as o}from"./index-C1nZs7mf.mjs";const w="https://api.maetaeng.go.th/api/v1",y=w.replace(/\/$/,""),m=e=>{if(!e)return"";if(/^https?:\/\//i.test(e))return e;const r=e.replace(/^\//,"");return`${y}/${r}`};function c(e,r){if(r==null||r==="")throw new Error(`${e} is required`)}function n(e,r){const t=e;if(t?.data&&"data"in t.data)return t.data.data;throw new Error(t?.data?.description||r)}function u(e){const r=e,t=r.fileUrl??r.file_url??r.filePath??r.file_path??"",a=m(t);return{id:String(r.id??""),moit_id:r.moit_id?String(r.moit_id):void 0,topic_id:r.topic_id?String(r.topic_id):void 0,title:String(r.title??""),description:r.description===void 0||r.description===null?void 0:String(r.description),sub_topic:String(r.sub_topic??""),quarter:r.quarter===void 0||r.quarter===null?void 0:String(r.quarter),fileName:r.fileName??r.file_name,fileUrl:a,createdAt:r.createdAt?String(r.createdAt):void 0,updatedAt:r.updatedAt?String(r.updatedAt):void 0}}const h={async getYears(){try{const e=await o.get("/ita/year-moit");return n(e,"ไม่สามารถดึงข้อมูลปีงบประมาณได้")}catch(e){throw console.error("getYears error:",e),new Error("ไม่สามารถดึงข้อมูลปีงบประมาณได้")}},async createYear(e){try{const r=await o.post("/ita/year-moit",e);return n(r,"ไม่สามารถสร้างปีงบประมาณใหม่ได้")}catch(r){throw console.error("createYear error:",r),new Error("ไม่สามารถสร้างปีงบประมาณใหม่ได้")}},async getYearById(e){c("yearId",e);try{const r=await o.get(`/ita/year-moit/${encodeURIComponent(String(e))}`);return n(r,"ไม่สามารถดึงข้อมูลปีที่เลือกได้")}catch(r){throw console.error("getYearById error:",r),new Error("ไม่สามารถดึงข้อมูลปีที่เลือกได้")}},async updateYear(e,r){c("yearId",e);try{const t=await o.put(`/ita/year-moit/${encodeURIComponent(String(e))}`,r);return n(t,"ไม่สามารถอัปเดตข้อมูลปีงบประมาณได้")}catch(t){throw console.error("updateYear error:",t),new Error("ไม่สามารถอัปเดตข้อมูลปีงบประมาณได้")}},async deleteYear(e){c("yearId",e);try{await o.delete(`/ita/year-moit/${encodeURIComponent(String(e))}`)}catch(r){throw console.error("deleteYear error:",r),new Error("ไม่สามารถลบปีงบประมาณได้")}},async getAllTopics(){const e="/user/year-moit";try{const r=await o.get(e);if(typeof r.data=="string"&&/^\s*<!doctype html/i.test(r.data))throw new Error("Invalid API response: expected JSON but received HTML");return n(r,"ไม่สามารถดึงข้อมูล ITA ทั้งหมดได้").map(d=>({...d,moits:d.moits.map(i=>({...i,documents:(i.documents||[]).map(p=>u(p))}))}))}catch(r){throw console.error("[itaService] getAllTopics error:",r),new Error("ไม่สามารถดึงข้อมูล ITA ทั้งหมดได้")}},async getMoitById(e){c("moitId",e);try{const r=await o.get(`/moit/year/${encodeURIComponent(String(e))}`);return n(r,"ไม่สามารถดึงข้อมูลหัวข้อได้")}catch(r){throw console.error("getMoitById error:",r),new Error("ไม่สามารถดึงข้อมูลหัวข้อได้")}},async createTopic(e){try{const r=await o.post("/moit",e);return n(r,"ไม่สามารถสร้างหัวข้อใหม่ได้")}catch(r){throw console.error("createTopic error:",r),new Error("ไม่สามารถสร้างหัวข้อใหม่ได้")}},async updateTopic(e,r){c("topicId",e);try{const t=await o.put(`/moit/${encodeURIComponent(String(e))}`,r);return n(t,"ไม่สามารถอัปเดตข้อมูลหัวข้อได้")}catch(t){throw console.error("updateTopic error:",t),new Error("ไม่สามารถอัปเดตข้อมูลหัวข้อได้")}},async deleteTopic(e){c("topicId",e);try{await o.delete(`/moit/${encodeURIComponent(String(e))}`)}catch(r){throw console.error("deleteTopic error:",r),new Error("ไม่สามารถลบหัวข้อได้")}},async getDocumentsByMoitId(e){c("moitId",e);try{const r=await o.get("/document/all"),t=n(r,"ไม่สามารถดึงรายการเอกสารทั้งหมดได้"),i=(l=>{if(Array.isArray(l))return l;if(l&&typeof l=="object"){const s=l;if(Array.isArray(s.items))return s.items;if(Array.isArray(s.rows))return s.rows;if(Array.isArray(s.data))return s.data;if(Array.isArray(s.results))return s.results}return[]})(t).map(u),p=String(e);return i.filter(l=>l.moit_id===p)}catch(r){throw console.error("getDocumentsByMoitId (filter frontend) error:",r),new Error("ไม่สามารถดึงรายการเอกสารของหัวข้อนี้ได้")}},async getDocumentById(e){c("docId",e);try{const r=await o.get(`/document/detail/${encodeURIComponent(String(e))}`),t=n(r,"ไม่สามารถดึงข้อมูลเอกสารได้");return u(t)}catch(r){throw console.error("getDocumentById error:",r),new Error("ไม่สามารถดึงข้อมูลเอกสารได้")}},async createDocument(e,r){c("moitId",e);try{r.set("moit_id",String(e));const t=r.get("quarter");r.set("quarter",String(t??""));const a=r.get("description");(a==null||a==="")&&r.delete("description");const d=await o.post("/document/create",r,{headers:{"Content-Type":"multipart/form-data"}}),i=n(d,"ไม่สามารถเพิ่มเอกสารใหม่ได้");return u(i)}catch(t){throw console.error("createDocument error:",t),new Error("ไม่สามารถเพิ่มเอกสารใหม่ได้")}},async updateDocument(e,r){c("docId",e);try{const t=r.get("quarter");t!=null&&r.set("quarter",String(t));const a=r.get("description");(a==null||a==="")&&r.delete("description");const d=await o.put(`/document/update/${encodeURIComponent(String(e))}`,r,{headers:{"Content-Type":"multipart/form-data"}}),i=n(d,"ไม่สามารถบันทึกการแก้ไขเอกสารได้");return u(i)}catch(t){throw console.error("updateDocument error:",t),new Error("ไม่สามารถบันทึกการแก้ไขเอกสารได้")}},async deleteDocument(e){c("docId",e);try{await o.delete(`/document/delete/${encodeURIComponent(String(e))}`)}catch(r){throw console.error("deleteDocument error:",r),new Error("ไม่สามารถลบเอกสารได้")}}};export{h as i};
